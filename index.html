<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I Just Wanna Lift</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            font-size: 18px;
            line-height: 1.6;
            color: #1a1a1a;
            background: #fafafa;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 32px;
            text-align: center;
        }

        h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #000;
        }

        .user-name {
            font-size: 18px;
            color: #666;
            font-weight: 400;
        }

        .day-section {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .day-header {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e0e0e0;
            color: #000;
        }

        .rest-day {
            text-align: center;
            font-size: 28px;
            font-weight: 600;
            color: #666;
            padding: 40px 0;
        }

        .lift {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .lift:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .lift-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #000;
        }

        .lift-sets-reps {
            font-size: 16px;
            color: #666;
            margin-bottom: 4px;
        }

        .lift-weight {
            font-size: 18px;
            color: #333;
            margin-bottom: 4px;
        }

        .lift-plates {
            font-size: 16px;
            color: #666;
        }

        .deload-indicator {
            display: inline-block;
            background: #ff9800;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            margin-left: 8px;
        }

        .plate-chip {
            display: inline-block;
            padding: 2px 8px;
            margin: 2px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #f5f5f5;
            font-size: 14px;
            color: #333;
        }

        .stats-table {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow-x: auto;
        }

        .stats-table h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #000;
        }

        .stats-table table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .stats-table th {
            background: #f5f5f5;
            padding: 8px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e0e0e0;
        }

        .stats-table td {
            padding: 8px;
            border-bottom: 1px solid #f0f0f0;
        }

        .stats-table tr:last-child td {
            border-bottom: none;
        }

        .percentage-positive {
            color: #2e7d32;
            font-weight: 600;
        }

        @media (max-width: 428px) {
            body {
                padding: 16px;
                font-size: 17px;
            }

            h1 {
                font-size: 22px;
            }

            .day-section {
                padding: 20px;
                margin-bottom: 20px;
            }

            .day-header {
                font-size: 18px;
            }

            .lift-name {
                font-size: 19px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1 id="header"></h1>
    </header>

    <div id="app"></div>

    <script type="application/json" id="program-config">
    {
      "user": {
        "name": "Stephen",
        "bodyweight_lb": 175,
        "start_date": "2025-09-15",
        "total_weeks": 52,
        "training_days": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"]
      },
      "bar_weight_lb": 45,
      "rep_scheme": {
        "low_reps": 5,
        "high_reps": 7
      },
      "schedule": {
        "pattern": {
          "A": ["Squat", "Overhead Press", "Pullup"],
          "B": ["Deadlift", "Bench", "Row"]
        },
        "cycle": ["A", "B", "A'", "B'"]
      },
      "sets_reps": {
        "Squat":   {"sets": 2, "alternate_reps": false},
        "Deadlift":{"sets": 2, "alternate_reps": false},
        "Overhead Press":{"sets": 3, "alternate_reps": true},
        "Bench":  {"sets": 3, "alternate_reps": true},
        "Row":    {"sets": 3, "alternate_reps": true},
        "Pullup": {"sets": 3, "alternate_reps": true, "type": "weighted_bodyweight"} 
      },
      "round_plates_per_side_to_lb": {
        "Squat": 1.25, 
        "Deadlift": 1.25, 
        "Overhead Press": 0.25, 
        "Bench": 0.25, 
        "Row": 0.25, 
        "Pullup": 1.25
      },
      "progression": {
        "alpha": 0.0105,
        "deload_every_weeks": 8,
        "deload_factor": 0.82
      },
      "targets": {
        "goal_bodyweight_multiple": {
          "Squat": 1.60,
          "Overhead Press": 0.65,
          "Pullup": 0.30,
          "Deadlift": 2.00,
          "Bench": 1.15,
          "Row": 0.85
        },
        "start_as_percentage_of_goal": {
          "Squat": 0.50,
          "Overhead Press": 0.50,
          "Pullup": 0.00,
          "Deadlift": 0.50,
          "Bench": 0.40,
          "Row": 0.60
        }
      },
      "plate_inventory_per_side_lb": [45, 25, 10, 5, 2.5, 1.25, 1, 0.75, 0.5, 0.25]
    }
    </script>

    <script>
        // Parse configuration
        function parseConfig() {
            const configEl = document.getElementById('program-config');
            return JSON.parse(configEl.textContent);
        }

        const config = parseConfig();

        // Date utilities
        function parseDate(dateStr) {
            return new Date(dateStr + 'T00:00:00');
        }

        function formatDate(date) {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${days[date.getDay()]}, ${months[date.getMonth()]} ${date.getDate()}`;
        }

        function getDaysElapsed(startDate, currentDate) {
            const start = parseDate(startDate);
            const current = parseDate(currentDate);
            const diffTime = current - start;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        function isTrainingDayISO(iso) {
            const d = parseDate(iso);
            const name = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][d.getDay()];
            return config.user.training_days.includes(name);
        }

        function isRestDayISO(iso) {
            return !isTrainingDayISO(iso);
        }

        function getTrainingDayNumber(startDate, currentDate) {
            const start = parseDate(startDate);
            const current = parseDate(currentDate);
            
            let trainingDays = 0;
            let date = new Date(start);
            
            while (date <= current) {
                const dateISO = formatDateISO(date);
                if (isTrainingDayISO(dateISO)) {
                    trainingDays++;
                }
                date.setDate(date.getDate() + 1);
            }
            
            return trainingDays;
        }

        function getCyclePosition(trainingDayNumber) {
            return (trainingDayNumber - 1) % 4;
        }

        function getWeekNumber(daysElapsed) {
            return Math.floor(daysElapsed / 7) + 1;
        }

        function isDeloadWeek(daysElapsed) {
            // Deload every 56 days (8 weeks)
            // Week 9 starts at day 56 (deload week)
            // Check if we've crossed a 56-day boundary this week
            if (daysElapsed < 7) return false; // First week can't be deload
            return Math.floor(daysElapsed / 56) > Math.floor((daysElapsed - 7) / 56);
        }

        function getRepsForExercise(lift, cyclePosition) {
            const exerciseConfig = config.sets_reps[lift];
            if (!exerciseConfig.alternate_reps) {
                return config.rep_scheme.low_reps;
            }
            // Positions 0,1 = low reps, positions 2,3 = high reps
            return (cyclePosition < 2) ? config.rep_scheme.low_reps : config.rep_scheme.high_reps;
        }

        // Weight calculations
        function compute1RM(lift, daysElapsed) {
            const goalWeight = config.targets.goal_bodyweight_multiple[lift] * config.user.bodyweight_lb;
            const startWeight = config.targets.start_as_percentage_of_goal[lift] * goalWeight;
            
            // Linear-log progression based on calendar days
            const t = Math.max(0, Math.min(daysElapsed, 730)); // Clamp at end of Year 2
            const T = 364; // Days 0-364 = 365 days total
            const alpha = config.progression.alpha;
            
            if (T === 0) return goalWeight;
            
            const progressionFactor = Math.log(1 + alpha * t) / Math.log(1 + alpha * T);
            const oneRM = startWeight + (goalWeight - startWeight) * progressionFactor;
            
            return oneRM;
        }

        function computeWorkingWeight(oneRM, reps, isDeload) {
            // Epley formula inverted: WorkingWeight = 1RM / (1 + reps/30)
            let workingWeight = oneRM / (1 + reps / 30);
            
            if (isDeload) {
                workingWeight *= config.progression.deload_factor;
            }
            
            return workingWeight;
        }

        function roundToIncrement(value, increment) {
            return Math.round(value / increment) * increment;
        }

        function plateMath(weightPerSide, plateInventory) {
            const plates = [];
            let remaining = weightPerSide;
            
            // Greedy algorithm: use largest plates first
            for (const plate of plateInventory) {
                while (remaining >= plate - 0.001) { // Small tolerance for floating point
                    plates.push(plate);
                    remaining -= plate;
                }
            }
            
            return plates;
        }

        function getNextTrainingDate(fromDate) {
            const date = parseDate(fromDate);
            date.setDate(date.getDate() + 1);
            
            while (isRestDayISO(formatDateISO(date))) {
                date.setDate(date.getDate() + 1);
            }
            
            return formatDateISO(date);
        }

        function formatDateISO(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Rendering
        function renderLift(lift, trainingDayNumber, date) {
            const cyclePosition = getCyclePosition(trainingDayNumber);
            const daysElapsed = getDaysElapsed(config.user.start_date, date);
            const weekNumber = getWeekNumber(daysElapsed);
            const reps = getRepsForExercise(lift, cyclePosition);
            const sets = config.sets_reps[lift].sets;
            const isDeload = isDeloadWeek(daysElapsed);
            
            // Calculate weights
            const oneRM = compute1RM(lift, daysElapsed);
            const workingWeight = computeWorkingWeight(oneRM, reps, isDeload);
            const roundIncrement = config.round_plates_per_side_to_lb[lift];
            
            // For regular lifts, round the total weight
            let totalWeight, weightPerSide;
            
            if (config.sets_reps[lift].type === 'weighted_bodyweight') {
                // For pullups, show total additional weight (not per side)
                totalWeight = roundToIncrement(workingWeight, roundIncrement);
                weightPerSide = 0; // Not applicable for pullups
            } else {
                // For barbell lifts, calculate weight per side after removing bar
                const totalBeforeRounding = workingWeight;
                weightPerSide = (totalBeforeRounding - config.bar_weight_lb) / 2;
                weightPerSide = roundToIncrement(weightPerSide, roundIncrement);
                totalWeight = config.bar_weight_lb + (weightPerSide * 2);
            }
            
            const plates = plateMath(weightPerSide, config.plate_inventory_per_side_lb);
            
            let html = `<div class="lift">`;
            html += `<div class="lift-name">${lift}</div>`;
            html += `<div class="lift-sets-reps">${sets}×${reps}</div>`;
            
            if (config.sets_reps[lift].type === 'weighted_bodyweight') {
                if (totalWeight > 0) {
                    html += `<div class="lift-weight">Add: ${totalWeight % 1 === 0 ? totalWeight : totalWeight.toFixed(2)} lb</div>`;
                } else {
                    html += `<div class="lift-weight">Bodyweight only</div>`;
                }
            } else {
                html += `<div class="lift-weight">Total: ${totalWeight % 1 === 0 ? totalWeight : totalWeight.toFixed(2)} lb</div>`;
                if (plates.length > 0) {
                    const platesHTML = plates.map(p => {
                        const plateLabel = p >= 1 ? p.toString() : p.toFixed(2);
                        return `<span class="plate-chip">${plateLabel}</span>`;
                    }).join('');
                    html += `<div class="lift-plates">Plates/side: ${platesHTML}</div>`;
                } else {
                    html += `<div class="lift-plates">Plates/side: <span class="plate-chip">empty bar</span></div>`;
                }
            }
            
            html += `</div>`;
            
            return html;
        }

        function renderTrainingDay(date, trainingDayNumber) {
            const cyclePosition = getCyclePosition(trainingDayNumber);
            const cycleDay = config.schedule.cycle[cyclePosition];
            const daysElapsed = getDaysElapsed(config.user.start_date, date);
            const weekNumber = getWeekNumber(daysElapsed);
            const isDeload = isDeloadWeek(daysElapsed);
            
            // Get pattern (A or B)
            const pattern = cycleDay.replace("'", "");
            const lifts = config.schedule.pattern[pattern];
            
            let html = `<div class="day-section">`;
            html += `<div class="day-header">Week ${weekNumber} • ${formatDate(parseDate(date))}`;
            if (isDeload) {
                html += `<span class="deload-indicator">DELOAD</span>`;
            }
            html += `</div>`;
            
            lifts.forEach(lift => {
                html += renderLift(lift, trainingDayNumber, date);
            });
            
            html += `</div>`;
            return html;
        }

        function renderRestDay(date) {
            const daysElapsed = getDaysElapsed(config.user.start_date, date);
            const weekNumber = getWeekNumber(daysElapsed);
            
            let html = `<div class="day-section">`;
            html += `<div class="day-header">Week ${weekNumber} • ${formatDate(parseDate(date))} • Rest Day</div>`;
            html += `<div class="rest-day">Rest</div>`;
            html += `</div>`;
            
            return html;
        }

        // Motivational statistics table
        function renderStatsTable() {
            const today = formatDateISO(new Date());
            const daysElapsed = getDaysElapsed(config.user.start_date, today);
            
            // Milestone days: 0, 6mo, 12mo, 18mo, 24mo
            const milestones = [
                { label: 'Start', days: 0 },
                { label: '6 Months', days: 182 },
                { label: '12 Months', days: 364 },
                { label: '18 Months', days: 546 },
                { label: '24 Months', days: 730 }
            ];
            
            // Get all lifts
            const lifts = ['Squat', 'Overhead Press', 'Pullup', 'Deadlift', 'Bench', 'Row'];
            const lowReps = config.rep_scheme.low_reps;
            
            let html = `<div class="stats-table">`;
            html += `<h2>Working Weight @ ${lowReps} Reps</h2>`;
            html += `<table>`;
            
            // Header row
            html += `<tr><th>Milestone</th>`;
            lifts.forEach(lift => {
                html += `<th>${lift} (lb)</th>`;
            });
            html += `</tr>`;
            
            // Data rows
            milestones.forEach(milestone => {
                html += `<tr><td><strong>${milestone.label}</strong></td>`;
                lifts.forEach(lift => {
                    const oneRM = compute1RM(lift, milestone.days);
                    const working = computeWorkingWeight(oneRM, lowReps, false);
                    const rounded = working % 1 === 0 ? working : working.toFixed(1);
                    html += `<td>${rounded}</td>`;
                });
                html += `</tr>`;
            });
            
            html += `</table>`;
            
            // Percentage increases (if enough time has passed)
            if (daysElapsed >= 30) {
                html += `<h2 style="margin-top: 24px;">Strength Gains</h2>`;
                html += `<table>`;
                html += `<tr><th>Time Period</th>`;
                lifts.forEach(lift => {
                    html += `<th>${lift}</th>`;
                });
                html += `</tr>`;
                
                // 1 month gain (if >= 1 month)
                if (daysElapsed >= 30) {
                    html += `<tr><td><strong>Last 1 Month</strong></td>`;
                    lifts.forEach(lift => {
                        const current = computeWorkingWeight(compute1RM(lift, daysElapsed), lowReps, false);
                        const previous = computeWorkingWeight(compute1RM(lift, Math.max(0, daysElapsed - 30)), lowReps, false);
                        const pct = previous > 0 ? ((current - previous) / previous * 100).toFixed(1) : 0;
                        html += `<td><span class="percentage-positive">+${pct}%</span></td>`;
                    });
                    html += `</tr>`;
                }
                
                // 6 month gain (if >= 6 months)
                if (daysElapsed >= 182) {
                    html += `<tr><td><strong>Last 6 Months</strong></td>`;
                    lifts.forEach(lift => {
                        const current = computeWorkingWeight(compute1RM(lift, daysElapsed), lowReps, false);
                        const previous = computeWorkingWeight(compute1RM(lift, Math.max(0, daysElapsed - 182)), lowReps, false);
                        const pct = previous > 0 ? ((current - previous) / previous * 100).toFixed(1) : 0;
                        html += `<td><span class="percentage-positive">+${pct}%</span></td>`;
                    });
                    html += `</tr>`;
                }
                
                // 1 year gain (if >= 1 year)
                if (daysElapsed >= 364) {
                    html += `<tr><td><strong>Last 1 Year</strong></td>`;
                    lifts.forEach(lift => {
                        const current = computeWorkingWeight(compute1RM(lift, daysElapsed), lowReps, false);
                        const previous = computeWorkingWeight(compute1RM(lift, Math.max(0, daysElapsed - 364)), lowReps, false);
                        const pct = previous > 0 ? ((current - previous) / previous * 100).toFixed(1) : 0;
                        html += `<td><span class="percentage-positive">+${pct}%</span></td>`;
                    });
                    html += `</tr>`;
                }
                
                html += `</table>`;
            }
            
            html += `</div>`;
            return html;
        }

        // Main render
        function render() {
            const today = formatDateISO(new Date());
            const app = document.getElementById('app');
            const header = document.getElementById('header');
            
            header.innerHTML = `I Just Wanna Lift <span class="user-name">• ${config.user.name}</span>`;
            
            let html = '';
            
            if (isRestDayISO(today)) {
                // Show rest day
                html += renderRestDay(today);
                
                // Show next two training days
                let nextDate = getNextTrainingDate(today);
                let nextTrainingDay = getTrainingDayNumber(config.user.start_date, nextDate);
                html += renderTrainingDay(nextDate, nextTrainingDay);
                
                nextDate = getNextTrainingDate(nextDate);
                nextTrainingDay = getTrainingDayNumber(config.user.start_date, nextDate);
                html += renderTrainingDay(nextDate, nextTrainingDay);
            } else {
                // Show today (training day)
                const todayTrainingDay = getTrainingDayNumber(config.user.start_date, today);
                html += renderTrainingDay(today, todayTrainingDay);
                
                // Show next training day
                const nextDate = getNextTrainingDate(today);
                const nextTrainingDay = getTrainingDayNumber(config.user.start_date, nextDate);
                html += renderTrainingDay(nextDate, nextTrainingDay);
            }
            
            // Add stats table at the bottom
            html += renderStatsTable();
            
            app.innerHTML = html;
        }

        // Initialize
        render();
    </script>
</body>
</html>
