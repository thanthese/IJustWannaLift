<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I Just Wanna Lift - Tests</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            color: #1a1a1a;
            background: #fafafa;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .summary {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        .summary.all-pass {
            background: #4caf50;
            color: white;
        }

        .summary.has-fail {
            background: #f44336;
            color: white;
        }

        table {
            width: 100%;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f5f5f5;
            font-weight: 600;
        }

        tr:last-child td {
            border-bottom: none;
        }

        .pass {
            color: #4caf50;
            font-weight: 600;
        }

        .fail {
            color: #f44336;
            font-weight: 600;
        }

        .test-category {
            margin-top: 30px;
            margin-bottom: 10px;
            font-size: 20px;
            font-weight: 600;
        }

        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>I Just Wanna Lift - Unit Tests</h1>
    <div id="summary" class="summary"></div>
    <div id="results"></div>

    <script>
        // Test configuration (matching spec)
        const testConfig = {
            user: {
                name: "Stephen",
                bodyweight_lb: 175,
                start_date: "2025-09-15",
                total_weeks: 52,
                training_days: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"]
            },
            bar_weight_lb: 45,
            rep_scheme: {
                "Squat": [5],
                "Overhead Press": [5, 6, 5, 7, 5, 6, 5, 8],
                "Pullup": [5, 6, 5, 7, 5, 6, 5, 8],
                "Deadlift": [5],
                "Bench": [5, 6, 5, 7, 5, 6, 5, 8],
                "Row": [5, 6, 5, 7, 5, 6, 5, 8]
            },
            schedule: {
                pattern: {
                    A: ["Squat", "Overhead Press", "Pullup"],
                    B: ["Deadlift", "Bench", "Row"]
                },
                cycle: ["A", "B"]
            },
            sets_reps: {
                "Squat": { sets: 2 },
                "Deadlift": { sets: 2 },
                "Overhead Press": { sets: 3 },
                "Bench": { sets: 3 },
                "Row": { sets: 3 },
                "Pullup": { sets: 3, type: "weighted_bodyweight" }
            },
            round_plates_per_side_to_lb: {
                "Squat": 1.25,
                "Deadlift": 1.25,
                "Overhead Press": 0.25,
                "Bench": 0.25,
                "Row": 0.25,
                "Pullup": 1.25
            },
            progression: {
                alpha: 0.0105,
                deload_every_weeks: 8,
                deload_factor: 0.82
            },
            targets: {
                goal_bodyweight_multiple: {
                    "Squat": 1.60,
                    "Overhead Press": 0.65,
                    "Pullup": 1.30,
                    "Deadlift": 2.00,
                    "Bench": 1.15,
                    "Row": 0.85
                },
                start_as_percentage_of_goal: {
                    "Squat": 0.50,
                    "Overhead Press": 0.50,
                    "Pullup": 0.769,
                    "Deadlift": 0.50,
                    "Bench": 0.40,
                    "Row": 0.60
                }
            },
            plate_inventory_per_side_lb: [45, 25, 10, 5, 2.5, 1.25, 1, 0.75, 0.5, 0.25]
        };

        // Copy of core functions from index.html
        function parseDate(dateStr) {
            return new Date(dateStr + 'T00:00:00');
        }

        function formatDate(date) {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${days[date.getDay()]}, ${months[date.getMonth()]} ${date.getDate()}`;
        }

        function getDaysElapsed(startDate, currentDate) {
            const start = parseDate(startDate);
            const current = parseDate(currentDate);
            const diffTime = current - start;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        function isTrainingDayISO(iso) {
            const d = parseDate(iso);
            const name = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][d.getDay()];
            return testConfig.user.training_days.includes(name);
        }

        function isRestDayISO(iso) {
            return !isTrainingDayISO(iso);
        }

        function getTrainingDayNumber(startDate, currentDate) {
            const start = parseDate(startDate);
            const current = parseDate(currentDate);
            
            let trainingDays = 0;
            let date = new Date(start);
            
            while (date <= current) {
                const dateISO = formatDateISO(date);
                if (isTrainingDayISO(dateISO)) {
                    trainingDays++;
                }
                date.setDate(date.getDate() + 1);
            }
            
            return trainingDays;
        }

        function formatDateISO(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getCyclePosition(trainingDayNumber) {
            return (trainingDayNumber - 1) % 2;
        }

        function getWeekNumber(daysElapsed) {
            return Math.floor(daysElapsed / 7) + 1;
        }

        function isDeloadWeek(daysElapsed) {
            // Deload every 56 days (8 weeks)
            // Week 9 starts at day 56 (deload week)
            // Check if we've crossed a 56-day boundary this week
            if (daysElapsed < 7) return false; // First week can't be deload
            return Math.floor(daysElapsed / 56) > Math.floor((daysElapsed - 7) / 56);
        }

        function getRepsForExercise(lift, trainingDayNumber) {
            const repArray = testConfig.rep_scheme[lift];
            if (!repArray || repArray.length === 0) {
                return 5; // Fallback default
            }
            
            // Calculate which occurrence of this lift it is
            // Since schedule alternates A/B, and trainingDayNumber is 1-indexed:
            // - Workout A (has Squat, OHP, Pullup): occurs on odd training days (1, 3, 5, ...)
            // - Workout B (has Deadlift, Bench, Row): occurs on even training days (2, 4, 6, ...)
            const cyclePosition = getCyclePosition(trainingDayNumber);
            const cycleDay = testConfig.schedule.cycle[cyclePosition];
            const pattern = cycleDay.replace("'", "");
            const liftsInThisWorkout = testConfig.schedule.pattern[pattern];
            
            // Only count training days where this lift appears
            if (!liftsInThisWorkout.includes(lift)) {
                return 5; // Shouldn't happen, but fallback
            }
            
            // Count how many times this workout pattern has occurred
            // Pattern A occurs on training days: 1, 3, 5, 7, 9... (odd)
            // Pattern B occurs on training days: 2, 4, 6, 8, 10... (even)
            const occurrenceNumber = Math.ceil(trainingDayNumber / testConfig.schedule.cycle.length);
            
            // Use the occurrence number to index into the rep array (0-indexed)
            return repArray[(occurrenceNumber - 1) % repArray.length];
        }

        function compute1RM(lift, daysElapsed) {
            // For weighted_bodyweight exercises (pullups), goal_bodyweight_multiple represents total load
            // For other exercises, it represents the weight on the bar
            const isWeightedBodyweight = testConfig.sets_reps[lift] && testConfig.sets_reps[lift].type === 'weighted_bodyweight';
            
            const goalWeight = testConfig.targets.goal_bodyweight_multiple[lift] * testConfig.user.bodyweight_lb;
            const startWeight = testConfig.targets.start_as_percentage_of_goal[lift] * goalWeight;
            
            const t = Math.max(0, Math.min(daysElapsed, 364));
            const T = 364;
            const alpha = testConfig.progression.alpha;
            
            if (T === 0) return goalWeight;
            
            const progressionFactor = Math.log(1 + alpha * t) / Math.log(1 + alpha * T);
            const oneRM = startWeight + (goalWeight - startWeight) * progressionFactor;
            
            // For pullups, oneRM is already total load (no adjustment needed)
            // For barbell lifts, oneRM is the weight on the bar
            return oneRM;
        }

        function computeWorkingWeight(oneRM, reps, isDeload, lift = null) {
            // Epley formula inverted: WorkingWeight = 1RM / (1 + reps/30)
            // For pullups, oneRM includes bodyweight already from compute1RM
            let workingWeight = oneRM / (1 + reps / 30);
            
            // Apply deload to total load (for pullups, this is BW + added weight)
            if (isDeload) {
                workingWeight *= testConfig.progression.deload_factor;
            }
            
            // For pullups, subtract bodyweight to get just the added weight
            // and ensure it doesn't go negative
            if (lift && testConfig.sets_reps[lift] && testConfig.sets_reps[lift].type === 'weighted_bodyweight') {
                workingWeight -= testConfig.user.bodyweight_lb;
                workingWeight = Math.max(0, workingWeight); // Floor at 0 (bodyweight only)
            }
            
            return workingWeight;
        }

        function roundToIncrement(value, increment) {
            return Math.round(value / increment) * increment;
        }

        function plateMath(weightPerSide, plateInventory) {
            const plates = [];
            let remaining = weightPerSide;
            
            for (const plate of plateInventory) {
                while (remaining >= plate - 0.001) {
                    plates.push(plate);
                    remaining -= plate;
                }
            }
            
            return plates;
        }

        // Test framework
        function assert(description, expected, actual, tolerance = 0.01) {
            let pass;
            if (typeof expected === 'number' && typeof actual === 'number') {
                pass = Math.abs(expected - actual) < tolerance;
            } else if (Array.isArray(expected) && Array.isArray(actual)) {
                pass = JSON.stringify(expected) === JSON.stringify(actual);
            } else {
                pass = expected === actual;
            }
            
            return { pass, description, expected, actual };
        }

        // Test suites
        const tests = [];

        function addTest(category, description, expected, actual, tolerance) {
            tests.push({
                category,
                ...assert(description, expected, actual, tolerance)
            });
        }

        // 1. Date & Day Calculations
        addTest('Date/Day', 'getDaysElapsed: same day', 0, getDaysElapsed('2025-09-15', '2025-09-15'));
        addTest('Date/Day', 'getDaysElapsed: next day', 1, getDaysElapsed('2025-09-15', '2025-09-16'));
        addTest('Date/Day', 'getDaysElapsed: one week', 7, getDaysElapsed('2025-09-15', '2025-09-22'));
        
        addTest('Date/Day', 'getTrainingDayNumber: Day 1 (Mon)', 1, getTrainingDayNumber('2025-09-15', '2025-09-15'));
        addTest('Date/Day', 'getTrainingDayNumber: Day 5 (Fri)', 5, getTrainingDayNumber('2025-09-15', '2025-09-19'));
        addTest('Date/Day', 'getTrainingDayNumber: Skip weekend to Day 6 (Mon)', 6, getTrainingDayNumber('2025-09-15', '2025-09-22'));
        addTest('Date/Day', 'getTrainingDayNumber: Day 10', 10, getTrainingDayNumber('2025-09-15', '2025-09-26'));
        
        addTest('Date/Day', 'getCyclePosition: Day 1 = 0 (A)', 0, getCyclePosition(1));
        addTest('Date/Day', 'getCyclePosition: Day 2 = 1 (B)', 1, getCyclePosition(2));
        addTest('Date/Day', 'getCyclePosition: Day 3 = 0 (A)', 0, getCyclePosition(3));
        addTest('Date/Day', 'getCyclePosition: Day 4 = 1 (B)', 1, getCyclePosition(4));
        addTest('Date/Day', 'getCyclePosition: Day 5 = 0 (A)', 0, getCyclePosition(5));
        
        addTest('Date/Day', 'getWeekNumber: Day 0 = Week 1', 1, getWeekNumber(0));
        addTest('Date/Day', 'getWeekNumber: Day 6 = Week 1', 1, getWeekNumber(6));
        addTest('Date/Day', 'getWeekNumber: Day 7 = Week 2', 2, getWeekNumber(7));
        addTest('Date/Day', 'getWeekNumber: Day 13 = Week 2', 2, getWeekNumber(13));
        addTest('Date/Day', 'getWeekNumber: Day 14 = Week 3', 3, getWeekNumber(14));

        // 2. Date Formatting
        addTest('Date Format', 'formatDateISO: standard date', '2025-09-15', formatDateISO(new Date('2025-09-15T00:00:00')));
        addTest('Date Format', 'formatDateISO: single digit month', '2025-01-05', formatDateISO(new Date('2025-01-05T00:00:00')));
        addTest('Date Format', 'formatDate includes day name', true, formatDate(parseDate('2025-09-15')).includes('Monday'));
        addTest('Date Format', 'formatDate includes month', true, formatDate(parseDate('2025-09-15')).includes('Sep'));

        // 3. Rep Selection (Variable-Length Rep Arrays)
        // NEW BEHAVIOR: Rep scheme advances per workout occurrence (A or B), not per absolute training day
        // Schedule: A, B, A, B, A, B...
        // Workout A: Squat, Overhead Press, Pullup (training days 1, 3, 5, 7, 9...)
        // Workout B: Deadlift, Bench, Row (training days 2, 4, 6, 8, 10...)
        
        // Flat rep arrays (length 1): Squat, Deadlift - always 5 reps
        addTest('Reps', 'Squat day 1 (A #1): 5 reps', 5, getRepsForExercise('Squat', 1));
        addTest('Reps', 'Squat day 3 (A #2): 5 reps (flat)', 5, getRepsForExercise('Squat', 3));
        addTest('Reps', 'Squat day 11 (A #6): 5 reps (flat)', 5, getRepsForExercise('Squat', 11));
        addTest('Reps', 'Deadlift day 2 (B #1): 5 reps', 5, getRepsForExercise('Deadlift', 2));
        addTest('Reps', 'Deadlift day 10 (B #5): 5 reps (flat)', 5, getRepsForExercise('Deadlift', 10));
        
        // Variable rep arrays (length 8): [5, 6, 5, 7, 5, 6, 5, 8]
        // Workout A lifts (Overhead Press, Pullup) - occur on odd training days
        // Test Overhead Press progression
        addTest('Reps', 'OHP day 1 (A #1): 5 reps', 5, getRepsForExercise('Overhead Press', 1));
        addTest('Reps', 'OHP day 3 (A #2): 6 reps', 6, getRepsForExercise('Overhead Press', 3));
        addTest('Reps', 'OHP day 5 (A #3): 5 reps', 5, getRepsForExercise('Overhead Press', 5));
        addTest('Reps', 'OHP day 7 (A #4): 7 reps', 7, getRepsForExercise('Overhead Press', 7));
        addTest('Reps', 'OHP day 9 (A #5): 5 reps', 5, getRepsForExercise('Overhead Press', 9));
        addTest('Reps', 'OHP day 11 (A #6): 6 reps', 6, getRepsForExercise('Overhead Press', 11));
        addTest('Reps', 'OHP day 13 (A #7): 5 reps', 5, getRepsForExercise('Overhead Press', 13));
        addTest('Reps', 'OHP day 15 (A #8): 8 reps', 8, getRepsForExercise('Overhead Press', 15));
        addTest('Reps', 'OHP day 17 (A #9): 5 reps (wraps)', 5, getRepsForExercise('Overhead Press', 17));
        
        // Test Pullup progression (same pattern as OHP since both in Workout A)
        addTest('Reps', 'Pullup day 1 (A #1): 5 reps', 5, getRepsForExercise('Pullup', 1));
        addTest('Reps', 'Pullup day 3 (A #2): 6 reps', 6, getRepsForExercise('Pullup', 3));
        addTest('Reps', 'Pullup day 5 (A #3): 5 reps', 5, getRepsForExercise('Pullup', 5));
        addTest('Reps', 'Pullup day 7 (A #4): 7 reps', 7, getRepsForExercise('Pullup', 7));
        addTest('Reps', 'Pullup day 9 (A #5): 5 reps', 5, getRepsForExercise('Pullup', 9));
        addTest('Reps', 'Pullup day 15 (A #8): 8 reps', 8, getRepsForExercise('Pullup', 15));
        addTest('Reps', 'Pullup day 17 (A #9): 5 reps (wraps)', 5, getRepsForExercise('Pullup', 17));
        
        // Workout B lifts (Bench, Row) - occur on even training days
        // Test Bench progression
        addTest('Reps', 'Bench day 2 (B #1): 5 reps', 5, getRepsForExercise('Bench', 2));
        addTest('Reps', 'Bench day 4 (B #2): 6 reps', 6, getRepsForExercise('Bench', 4));
        addTest('Reps', 'Bench day 6 (B #3): 5 reps', 5, getRepsForExercise('Bench', 6));
        addTest('Reps', 'Bench day 8 (B #4): 7 reps', 7, getRepsForExercise('Bench', 8));
        addTest('Reps', 'Bench day 10 (B #5): 5 reps', 5, getRepsForExercise('Bench', 10));
        addTest('Reps', 'Bench day 12 (B #6): 6 reps', 6, getRepsForExercise('Bench', 12));
        addTest('Reps', 'Bench day 14 (B #7): 5 reps', 5, getRepsForExercise('Bench', 14));
        addTest('Reps', 'Bench day 16 (B #8): 8 reps', 8, getRepsForExercise('Bench', 16));
        addTest('Reps', 'Bench day 18 (B #9): 5 reps (wraps)', 5, getRepsForExercise('Bench', 18));
        
        // Test Row progression (same pattern as Bench since both in Workout B)
        addTest('Reps', 'Row day 2 (B #1): 5 reps', 5, getRepsForExercise('Row', 2));
        addTest('Reps', 'Row day 4 (B #2): 6 reps', 6, getRepsForExercise('Row', 4));
        addTest('Reps', 'Row day 8 (B #4): 7 reps', 7, getRepsForExercise('Row', 8));
        addTest('Reps', 'Row day 16 (B #8): 8 reps', 8, getRepsForExercise('Row', 16));
        addTest('Reps', 'Row day 18 (B #9): 5 reps (wraps)', 5, getRepsForExercise('Row', 18));
        
        // Test edge cases and larger numbers
        addTest('Reps', 'Pullup day 31 (A #16): 8 reps', 8, getRepsForExercise('Pullup', 31)); // ceil(31/2)=16, (16-1)%8=7 -> 8 reps
        addTest('Reps', 'Bench day 100 (B #50): 6 reps', 6, getRepsForExercise('Bench', 100)); // ceil(100/2)=50, (50-1)%8=1 -> 6 reps

        // 4. Weight Progression (using calendar days: Day 0 = start, Day 364 = end of year)
        // Calculate expected values from config
        const squatGoal = testConfig.targets.goal_bodyweight_multiple['Squat'] * testConfig.user.bodyweight_lb;
        const squatStart = testConfig.targets.start_as_percentage_of_goal['Squat'] * squatGoal;
        addTest('1RM', 'Squat Day 0: start weight', squatStart, compute1RM('Squat', 0), 0.1);
        addTest('1RM', 'Squat Day 182: 2/3 to goal', squatStart + (squatGoal - squatStart) * 2/3, compute1RM('Squat', 182), 2.5);
        addTest('1RM', 'Squat Day 364: goal weight', squatGoal, compute1RM('Squat', 364), 0.1);
        
        const pullupGoal = testConfig.targets.goal_bodyweight_multiple['Pullup'] * testConfig.user.bodyweight_lb;
        const pullupStart = testConfig.targets.start_as_percentage_of_goal['Pullup'] * pullupGoal;
        // Note: compute1RM now returns total load for pullups (goal is 1.3x BW = 227.5 lb total)
        addTest('1RM', 'Pullup Day 0: start at 76.9% of goal', pullupStart, compute1RM('Pullup', 0), 0.1);
        addTest('1RM', 'Pullup Day 182: 2/3 to goal', pullupStart + (pullupGoal - pullupStart) * 2/3, compute1RM('Pullup', 182), 1.0);
        addTest('1RM', 'Pullup Day 364: goal weight (1.3x BW)', pullupGoal, compute1RM('Pullup', 364), 0.1);
        
        const deadliftGoal = testConfig.targets.goal_bodyweight_multiple['Deadlift'] * testConfig.user.bodyweight_lb;
        const deadliftStart = testConfig.targets.start_as_percentage_of_goal['Deadlift'] * deadliftGoal;
        addTest('1RM', 'Deadlift Day 0: start weight', deadliftStart, compute1RM('Deadlift', 0), 0.1);
        addTest('1RM', 'Deadlift Day 182: 2/3 to goal', deadliftStart + (deadliftGoal - deadliftStart) * 2/3, compute1RM('Deadlift', 182), 3.0);
        addTest('1RM', 'Deadlift Day 364: goal weight', deadliftGoal, compute1RM('Deadlift', 364), 0.1);
        
        const benchGoal = testConfig.targets.goal_bodyweight_multiple['Bench'] * testConfig.user.bodyweight_lb;
        const benchStart = testConfig.targets.start_as_percentage_of_goal['Bench'] * benchGoal;
        addTest('1RM', 'Bench Day 0: start weight', benchStart, compute1RM('Bench', 0), 0.1);
        addTest('1RM', 'Bench Day 182: 2/3 to goal', benchStart + (benchGoal - benchStart) * 2/3, compute1RM('Bench', 182), 2.0);
        addTest('1RM', 'Bench Day 364: goal weight', benchGoal, compute1RM('Bench', 364), 0.1);
        
        const ohpGoal = testConfig.targets.goal_bodyweight_multiple['Overhead Press'] * testConfig.user.bodyweight_lb;
        const ohpStart = testConfig.targets.start_as_percentage_of_goal['Overhead Press'] * ohpGoal;
        addTest('1RM', 'OHP Day 0: start weight', ohpStart, compute1RM('Overhead Press', 0), 0.1);
        addTest('1RM', 'OHP Day 182: 2/3 to goal', ohpStart + (ohpGoal - ohpStart) * 2/3, compute1RM('Overhead Press', 182), 1.0);
        addTest('1RM', 'OHP Day 364: goal weight', ohpGoal, compute1RM('Overhead Press', 364), 0.1);
        
        const rowGoal = testConfig.targets.goal_bodyweight_multiple['Row'] * testConfig.user.bodyweight_lb;
        const rowStart = testConfig.targets.start_as_percentage_of_goal['Row'] * rowGoal;
        addTest('1RM', 'Row Day 0: start weight', rowStart, compute1RM('Row', 0), 0.1);
        addTest('1RM', 'Row Day 182: 2/3 to goal', rowStart + (rowGoal - rowStart) * 2/3, compute1RM('Row', 182), 1.5);
        addTest('1RM', 'Row Day 364: goal weight', rowGoal, compute1RM('Row', 364), 0.1);

        // 5. Working Weight (Epley)
        addTest('Epley', '200 lb 1RM at 5 reps', 171.43, computeWorkingWeight(200, 5, false), 0.1);
        addTest('Epley', '200 lb 1RM at 7 reps', 162.16, computeWorkingWeight(200, 7, false), 0.1);
        addTest('Epley', '200 lb 1RM at 5 reps with deload', 140.57, computeWorkingWeight(200, 5, true), 0.1);
        addTest('Epley', '100 lb 1RM at 5 reps', 85.71, computeWorkingWeight(100, 5, false), 0.1);

        // 6. Rounding
        addTest('Rounding', '100.1 to 0.25 lb', 100, roundToIncrement(100.1, 0.25));
        addTest('Rounding', '100.13 to 0.25 lb', 100.25, roundToIncrement(100.13, 0.25));
        addTest('Rounding', '100.24 to 0.25 lb', 100.25, roundToIncrement(100.24, 0.25));
        addTest('Rounding', '57.4 to 1.25 lb', 57.5, roundToIncrement(57.4, 1.25));
        addTest('Rounding', '57.6 to 1.25 lb', 57.5, roundToIncrement(57.6, 1.25));
        addTest('Rounding', '58.7 to 1.25 lb', 58.75, roundToIncrement(58.7, 1.25));

        // 7. Plate Math
        addTest('Plates', '100 lb/side', [45, 45, 10], plateMath(100, testConfig.plate_inventory_per_side_lb));
        addTest('Plates', '57.5 lb/side', [45, 10, 2.5], plateMath(57.5, testConfig.plate_inventory_per_side_lb));
        addTest('Plates', '2.75 lb/side', [2.5, 0.25], plateMath(2.75, testConfig.plate_inventory_per_side_lb));
        addTest('Plates', '0 lb/side', [], plateMath(0, testConfig.plate_inventory_per_side_lb));
        addTest('Plates', '45 lb/side', [45], plateMath(45, testConfig.plate_inventory_per_side_lb));

        // 8. Deload Application (calendar days not week numbers!)
        addTest('Deload Days', 'isDeloadWeek: Day 56 (end of week 8)', true, isDeloadWeek(56));
        addTest('Deload Days', 'isDeloadWeek: Day 55 (last day of week 8)', false, isDeloadWeek(55));
        addTest('Deload Days', 'isDeloadWeek: Day 112 (end of week 16)', true, isDeloadWeek(112));
        addTest('Deload Days', 'isDeloadWeek: Day 168 (end of week 24)', true, isDeloadWeek(168));
        addTest('Deload Days', 'isDeloadWeek: Day 49 (week 7)', false, isDeloadWeek(49));
        addTest('Deload Days', 'isDeloadWeek: Day 63 (week 9)', false, isDeloadWeek(63));

        // 9. Rest/Training Day Functions (updated for config-driven)
        addTest('Rest/Training', 'isTrainingDayISO: Monday', true, isTrainingDayISO('2025-09-15'));
        addTest('Rest/Training', 'isTrainingDayISO: Friday', true, isTrainingDayISO('2025-09-19'));
        addTest('Rest/Training', 'isTrainingDayISO: Saturday', false, isTrainingDayISO('2025-09-20'));
        addTest('Rest/Training', 'isTrainingDayISO: Sunday', false, isTrainingDayISO('2025-09-21'));
        addTest('Rest/Training', 'isRestDayISO: Saturday', true, isRestDayISO('2025-09-20'));
        addTest('Rest/Training', 'isRestDayISO: Monday', false, isRestDayISO('2025-09-15'));

        // 10. End-to-End Working Weight (1RM → Epley → Round → Plates)
        // Squat on Day 28 (Mon Oct 13)
        const day28Squat1RM = compute1RM('Squat', 28);
        const day28SquatWorking = computeWorkingWeight(day28Squat1RM, 5, false);
        const day28SquatPerSide = (day28SquatWorking - testConfig.bar_weight_lb) / 2;
        const day28SquatRounded = roundToIncrement(day28SquatPerSide, 1.25);
        const day28SquatTotal = testConfig.bar_weight_lb + day28SquatRounded * 2;
        addTest('End-to-End', 'Squat Day 28: 1RM', 162.94, day28Squat1RM, 0.5);
        addTest('End-to-End', 'Squat Day 28: Working weight (5 reps)', 139.66, day28SquatWorking, 0.5);
        addTest('End-to-End', 'Squat Day 28: Total rounded weight', 140.0, day28SquatTotal, 0.5);
        
        // 11. Spreadsheet Validation (compare against known good values from your spreadsheet)
        // Week 5 = Day 35 (end of week 5)
        // NOTE: These are snapshot tests - update them when you regenerate your spreadsheet with new goals
        addTest('Spreadsheet', 'Squat Week 5 (Day 35)', 167.85, compute1RM('Squat', 35), 0.5);
        addTest('Spreadsheet', 'OHP Week 5 (Day 35)', 68.19, compute1RM('Overhead Press', 35), 0.5);
        addTest('Spreadsheet', 'Pullup Week 5 (Day 35) - total load', 185.44, compute1RM('Pullup', 35), 0.5);
        addTest('Spreadsheet', 'Deadlift Week 5 (Day 35)', 209.82, compute1RM('Deadlift', 35), 0.5);
        addTest('Spreadsheet', 'Bench Week 5 (Day 35)', 104.52, compute1RM('Bench', 35), 0.5);
        addTest('Spreadsheet', 'Row Week 5 (Day 35)', 101.09, compute1RM('Row', 35), 0.5);
        
        // Week 1 = Day 7
        addTest('Spreadsheet', 'Squat Week 1 (Day 7)', 146.31, compute1RM('Squat', 7), 0.5);
        addTest('Spreadsheet', 'Bench Week 1 (Day 7)', 85.94, compute1RM('Bench', 7), 0.5);
        
        // Week 52 = Day 364 (should hit goals from config)
        addTest('Spreadsheet', 'Squat Week 52 (Day 364)', squatGoal, compute1RM('Squat', 364), 0.5);
        addTest('Spreadsheet', 'Bench Week 52 (Day 364)', benchGoal, compute1RM('Bench', 364), 0.5);
        addTest('Spreadsheet', 'OHP Week 52 (Day 364)', ohpGoal, compute1RM('Overhead Press', 364), 0.5);

        // 12. Edge Cases
        addTest('Edge Cases', '1RM at Day -1 (before start)', squatStart, compute1RM('Squat', -1), 0.1);
        addTest('Edge Cases', '1RM at Day 400 (past end)', squatGoal, compute1RM('Squat', 400), 0.1);
        addTest('Edge Cases', 'getWeekNumber: Day 0', 1, getWeekNumber(0));
        addTest('Edge Cases', 'getWeekNumber: Day 364', 53, getWeekNumber(364));

        // 13. Deload Factor Application
        const deloadOneRM = 200;
        const normalWorking = computeWorkingWeight(deloadOneRM, 5, false);
        const deloadWorking = computeWorkingWeight(deloadOneRM, 5, true);
        addTest('Deload Factor', 'Normal working weight (200 @ 5 reps)', 171.43, normalWorking, 0.1);
        addTest('Deload Factor', 'Deload working weight (200 @ 5 reps)', 140.57, deloadWorking, 0.1);
        addTest('Deload Factor', 'Deload is 82% of normal', normalWorking * 0.82, deloadWorking, 0.1);

        // 14. Weighted Bodyweight Exercise (Pullups)
        // Use Day 140 where pullup has progressed enough to have added weight
        const pullup1RM_day140 = compute1RM('Pullup', 140); // This is total load (goal is 1.3x BW)
        const pullupWorking_5reps = computeWorkingWeight(pullup1RM_day140, 5, false, 'Pullup'); // This returns just added weight
        const pullupRounded = roundToIncrement(pullupWorking_5reps, testConfig.round_plates_per_side_to_lb['Pullup']);
        // Expected: Apply Epley formula to total load, then subtract BW and floor at 0
        const expectedWorking_5reps = Math.max(0, pullup1RM_day140 / (1 + 5/30) - testConfig.user.bodyweight_lb);
        addTest('Pullup', 'Pullup 1RM Day 140 - total load', 205.15, pullup1RM_day140, 0.5);
        addTest('Pullup', 'Pullup working weight (5 reps) - added only', expectedWorking_5reps, pullupWorking_5reps, 0.5);
        addTest('Pullup', 'Pullup working weight > 0', true, pullupWorking_5reps >= 0);
        // Pullup should NOT divide by 2 or subtract bar weight (it's total added weight)
        
        // 14b. Pullup with varying reps (testing Epley formula uses total load correctly)
        // Use Day 350 (near end of Year 1) where pullup is strong enough that even 8 reps has added weight
        const pullup1RM_day350 = compute1RM('Pullup', 350); // Total load - use late day with more weight
        const pullupAdd_5reps = computeWorkingWeight(pullup1RM_day350, 5, false, 'Pullup');
        const pullupAdd_6reps = computeWorkingWeight(pullup1RM_day350, 6, false, 'Pullup');
        const pullupAdd_7reps = computeWorkingWeight(pullup1RM_day350, 7, false, 'Pullup');
        const pullupAdd_8reps = computeWorkingWeight(pullup1RM_day350, 8, false, 'Pullup');
        addTest('Pullup Reps', 'Higher reps = less added weight', true, pullupAdd_8reps < pullupAdd_7reps && pullupAdd_7reps < pullupAdd_6reps && pullupAdd_6reps < pullupAdd_5reps);
        addTest('Pullup Reps', 'All added weights >= 0', true, pullupAdd_5reps >= 0 && pullupAdd_6reps >= 0 && pullupAdd_7reps >= 0 && pullupAdd_8reps >= 0);
        
        // 14c. Pullup deload (testing deload applied to total load, not just added weight)
        const pullup1RM_day350_deload = compute1RM('Pullup', 350); // Total load
        const pullupNormal = computeWorkingWeight(pullup1RM_day350_deload, 5, false, 'Pullup'); // Added weight
        const pullupDeload = computeWorkingWeight(pullup1RM_day350_deload, 5, true, 'Pullup'); // Added weight after deload
        // Calculate what the deload SHOULD be: ((totalLoad * 0.82) / (1 + reps/30)) - BW, floored at 0
        const expectedDeload = Math.max(0, (pullup1RM_day350_deload * 0.82 / (1 + 5/30)) - testConfig.user.bodyweight_lb);
        addTest('Pullup Deload', 'Deload applied to total load correctly', expectedDeload, pullupDeload, 0.5);
        addTest('Pullup Deload', 'Deload reduces added weight', true, pullupDeload <= pullupNormal); // <= because both might be 0
        
        // 14d. Pullup floor at bodyweight (added weight can't go negative)
        // Simulate early days where total working weight might be less than bodyweight
        const veryEarlyPullup1RM = testConfig.user.bodyweight_lb + 5; // Only 5 lb over BW
        const pullupEarlyHeavyReps = computeWorkingWeight(veryEarlyPullup1RM, 8, false, 'Pullup');
        addTest('Pullup Floor', 'Added weight floors at 0 (bodyweight only)', true, pullupEarlyHeavyReps >= 0);
        // With high reps and low total load, working weight could drop below BW
        const pullupWithDeloadFloor = computeWorkingWeight(veryEarlyPullup1RM, 8, true, 'Pullup');
        addTest('Pullup Floor', 'Deload + high reps still floors at 0', 0, pullupWithDeloadFloor, 0.1);
        
        // 14e. Explicit Epley floor test - demonstrate that Epley formula respects bodyweight floor
        // Use a scenario where Epley would give total load < BW (thus negative added weight)
        const lowPullup1RM = testConfig.user.bodyweight_lb * 0.95; // 1RM is 95% of bodyweight
        const pullupEpleyRaw = lowPullup1RM / (1 + 5/30); // This will be less than BW
        const pullupEpleyMinusBW = pullupEpleyRaw - testConfig.user.bodyweight_lb; // This will be negative
        const pullupActual = computeWorkingWeight(lowPullup1RM, 5, false, 'Pullup'); // Should be floored at 0
        addTest('Pullup Floor', 'Epley formula: when total load < BW, added weight floors at 0', true, pullupEpleyMinusBW < 0 && pullupActual === 0);
        addTest('Pullup Floor', 'Epley example: 166.25 lb total at 5 reps = 142.5 - 175 = -32.5, floored to 0', 0, computeWorkingWeight(lowPullup1RM, 5, false, 'Pullup'), 0.1);

        // 15. Rep Patterns by Workout Occurrence (not absolute training day)
        // OHP has pattern [5, 6, 5, 7, 5, 6, 5, 8] and only occurs in Workout A (odd training days)
        // Training Day 1 = Workout A #1, Training Day 3 = Workout A #2, etc.
        addTest('Rep Cycle', 'OHP Training Day 1 (A #1): 5 reps', 5, getRepsForExercise('Overhead Press', 1));
        addTest('Rep Cycle', 'OHP Training Day 3 (A #2): 6 reps', 6, getRepsForExercise('Overhead Press', 3));
        addTest('Rep Cycle', 'OHP Training Day 5 (A #3): 5 reps', 5, getRepsForExercise('Overhead Press', 5));
        addTest('Rep Cycle', 'OHP Training Day 7 (A #4): 7 reps', 7, getRepsForExercise('Overhead Press', 7));
        
        // Verify working weight changes with reps (Epley formula test)
        const ohp1RM = 100;
        const ohpWork5 = computeWorkingWeight(ohp1RM, 5, false);
        const ohpWork6 = computeWorkingWeight(ohp1RM, 6, false);
        const ohpWork7 = computeWorkingWeight(ohp1RM, 7, false);
        const ohpWork8 = computeWorkingWeight(ohp1RM, 8, false);
        addTest('Rep Cycle', 'OHP 100lb 1RM @ 5 reps', 85.71, ohpWork5, 0.1);
        addTest('Rep Cycle', 'OHP 100lb 1RM @ 6 reps', 83.33, ohpWork6, 0.1);
        addTest('Rep Cycle', 'OHP 100lb 1RM @ 7 reps', 81.08, ohpWork7, 0.1);
        addTest('Rep Cycle', 'OHP 100lb 1RM @ 8 reps', 78.95, ohpWork8, 0.1);
        addTest('Rep Cycle', 'Higher reps = lighter weight (6<5)', true, ohpWork6 < ohpWork5);
        addTest('Rep Cycle', 'Higher reps = lighter weight (7<6)', true, ohpWork7 < ohpWork6);
        addTest('Rep Cycle', 'Higher reps = lighter weight (8<7)', true, ohpWork8 < ohpWork7);

        // 15b. End-to-End Rep Cycle with Epley Formula
        // Verify that on consecutive OHP days, the correct reps are used AND Epley is applied
        // Using a fixed 1RM to isolate the rep/Epley logic from progression
        const fixed1RM = 100;
        
        // Training Day 1 (Workout A #1): 5 reps
        const td1_reps = getRepsForExercise('Overhead Press', 1);
        const td1_weight = computeWorkingWeight(fixed1RM, td1_reps, false);
        addTest('Rep Cycle E2E', 'TD1: Uses 5 reps', 5, td1_reps);
        addTest('Rep Cycle E2E', 'TD1: Applies Epley for 5 reps', 85.71, td1_weight, 0.1);
        
        // Training Day 3 (Workout A #2): 6 reps (should be lighter)
        const td3_reps = getRepsForExercise('Overhead Press', 3);
        const td3_weight = computeWorkingWeight(fixed1RM, td3_reps, false);
        addTest('Rep Cycle E2E', 'TD3: Uses 6 reps', 6, td3_reps);
        addTest('Rep Cycle E2E', 'TD3: Applies Epley for 6 reps', 83.33, td3_weight, 0.1);
        addTest('Rep Cycle E2E', 'TD3: Lighter than TD1 (6 reps vs 5)', true, td3_weight < td1_weight);
        
        // Training Day 7 (Workout A #4): 7 reps (should be even lighter)
        const td7_reps = getRepsForExercise('Overhead Press', 7);
        const td7_weight = computeWorkingWeight(fixed1RM, td7_reps, false);
        addTest('Rep Cycle E2E', 'TD7: Uses 7 reps', 7, td7_reps);
        addTest('Rep Cycle E2E', 'TD7: Applies Epley for 7 reps', 81.08, td7_weight, 0.1);
        addTest('Rep Cycle E2E', 'TD7: Lighter than TD3 (7 reps vs 6)', true, td7_weight < td3_weight);
        
        // Training Day 15 (Workout A #8): 8 reps (lightest in cycle)
        const td15_reps = getRepsForExercise('Overhead Press', 15);
        const td15_weight = computeWorkingWeight(fixed1RM, td15_reps, false);
        addTest('Rep Cycle E2E', 'TD15: Uses 8 reps', 8, td15_reps);
        addTest('Rep Cycle E2E', 'TD15: Applies Epley for 8 reps', 78.95, td15_weight, 0.1);
        addTest('Rep Cycle E2E', 'TD15: Lighter than TD7 (8 reps vs 7)', true, td15_weight < td7_weight);

        // 16. End-to-End Deload Week
        // Day 56 = first deload day
        const squat1RM_day56 = compute1RM('Squat', 56);
        const squatWorkingNormal_day56 = computeWorkingWeight(squat1RM_day56, 5, false);
        const squatWorkingDeload_day56 = computeWorkingWeight(squat1RM_day56, 5, true);
        const squatDeloadPerSide = (squatWorkingDeload_day56 - testConfig.bar_weight_lb) / 2;
        const squatDeloadRounded = roundToIncrement(squatDeloadPerSide, 1.25);
        const squatDeloadTotal = testConfig.bar_weight_lb + squatDeloadRounded * 2;
        addTest('Deload E2E', 'Squat Day 56: is deload week', true, isDeloadWeek(56));
        addTest('Deload E2E', 'Squat Day 56: 1RM', 181.16, squat1RM_day56, 0.5);
        addTest('Deload E2E', 'Squat Day 56: normal working', 155.28, squatWorkingNormal_day56, 0.5);
        addTest('Deload E2E', 'Squat Day 56: deload working', 127.33, squatWorkingDeload_day56, 0.5);
        addTest('Deload E2E', 'Squat Day 56: deload total', 127.50, squatDeloadTotal, 0.5);

        // 17. Date Navigation
        addTest('Date Nav', 'Next training after Mon', '2025-09-16', getNextTrainingDate('2025-09-15'));
        addTest('Date Nav', 'Next training after Fri', '2025-09-22', getNextTrainingDate('2025-09-19'));
        addTest('Date Nav', 'Next training after Sat (skip Sun)', '2025-09-22', getNextTrainingDate('2025-09-20'));
        addTest('Date Nav', 'Next training after Sun', '2025-09-22', getNextTrainingDate('2025-09-21'));
        
        function getNextTrainingDate(fromDate) {
            const date = parseDate(fromDate);
            date.setDate(date.getDate() + 1);
            while (isRestDayISO(formatDateISO(date))) {
                date.setDate(date.getDate() + 1);
            }
            return formatDateISO(date);
        }

        // 18. Multiple Exercises Same Day (Independence)
        // Day 28: Squat, OHP, Pullup (A workout)
        const day28_squat = compute1RM('Squat', 28);
        const day28_ohp = compute1RM('Overhead Press', 28);
        const day28_pullup = compute1RM('Pullup', 28);
        addTest('Multi-Exercise', 'Day 28 Squat 1RM', 162.94, day28_squat, 0.5);
        addTest('Multi-Exercise', 'Day 28 OHP 1RM', 66.19, day28_ohp, 0.5);
        addTest('Multi-Exercise', 'Day 28 Pullup 1RM (total load)', 183.56, day28_pullup, 0.5);
        // All different exercises should have independent progressions
        addTest('Multi-Exercise', 'Exercises are independent', true, day28_squat !== day28_ohp && day28_ohp !== day28_pullup);

        // 19. Long-term Stability
        // Test that progression is smooth over long periods
        const day100 = compute1RM('Squat', 100);
        const day200 = compute1RM('Squat', 200);
        const day300 = compute1RM('Squat', 300);
        addTest('Long-term', 'Day 100 < Day 200', true, day100 < day200);
        addTest('Long-term', 'Day 200 < Day 300', true, day200 < day300);
        addTest('Long-term', 'Day 300 < Goal', true, day300 < squatGoal);
        addTest('Long-term', 'Progression is monotonic', true, day100 < day200 && day200 < day300);

        // 20. Rounding Edge Cases
        addTest('Rounding Edge', '42.50 to 1.25 rounds correctly', 42.5, roundToIncrement(42.5, 1.25));
        addTest('Rounding Edge', '42.6249 rounds to 42.5', 42.5, roundToIncrement(42.6249, 1.25));
        addTest('Rounding Edge', '42.625 rounds to 42.5', 42.5, roundToIncrement(42.625, 1.25));
        addTest('Rounding Edge', '43.5 rounds to 43.75', 43.75, roundToIncrement(43.5, 1.25));
        addTest('Rounding Edge', '0.125 to 0.25 rounds to 0.25', 0.25, roundToIncrement(0.125, 0.25));
        addTest('Rounding Edge', '0.124 to 0.25 rounds to 0', 0, roundToIncrement(0.124, 0.25));

        // 21. Zero/Empty Plate Cases
        addTest('Zero Plates', 'Empty bar (0 per side)', [], plateMath(0, testConfig.plate_inventory_per_side_lb));
        addTest('Zero Plates', 'Very small weight (0.1 per side)', [], plateMath(0.1, testConfig.plate_inventory_per_side_lb));
        addTest('Zero Plates', 'Exactly 0.25 plate', [0.25], plateMath(0.25, testConfig.plate_inventory_per_side_lb));

        // 22. Cycle Position Wraparound
        // Cycle is 2 positions (A/B): (trainingDay - 1) % 2
        addTest('Cycle Wrap', 'Training Day 5 wraps to position 0 (A)', 0, getCyclePosition(5));
        addTest('Cycle Wrap', 'Training Day 6 wraps to position 1 (B)', 1, getCyclePosition(6));
        addTest('Cycle Wrap', 'Training Day 7 wraps to position 0 (A)', 0, getCyclePosition(7));
        addTest('Cycle Wrap', 'Training Day 100 position (even=B)', 1, getCyclePosition(100));
        addTest('Cycle Wrap', 'Training Day 101 position (odd=A)', 0, getCyclePosition(101));

        // Render results
        function renderResults() {
            const passed = tests.filter(t => t.pass).length;
            const failed = tests.filter(t => !t.pass).length;
            const total = tests.length;
            
            const summaryEl = document.getElementById('summary');
            summaryEl.className = `summary ${failed === 0 ? 'all-pass' : 'has-fail'}`;
            summaryEl.textContent = `Tests: ${passed} passed, ${failed} failed (${total} total)`;
            
            const categories = [...new Set(tests.map(t => t.category))];
            const resultsEl = document.getElementById('results');
            
            let html = '';
            categories.forEach(category => {
                const categoryTests = tests.filter(t => t.category === category);
                html += `<h2 class="test-category">${category}</h2>`;
                html += `<table>`;
                html += `<thead><tr><th>Status</th><th>Description</th><th>Expected</th><th>Actual</th></tr></thead>`;
                html += `<tbody>`;
                
                categoryTests.forEach(test => {
                    const statusClass = test.pass ? 'pass' : 'fail';
                    const statusText = test.pass ? '✓ PASS' : '✗ FAIL';
                    const expectedStr = Array.isArray(test.expected) 
                        ? `[${test.expected.join(', ')}]` 
                        : test.expected;
                    const actualStr = Array.isArray(test.actual) 
                        ? `[${test.actual.join(', ')}]` 
                        : test.actual;
                    
                    html += `<tr>`;
                    html += `<td class="${statusClass}">${statusText}</td>`;
                    html += `<td>${test.description}</td>`;
                    html += `<td><code>${expectedStr}</code></td>`;
                    html += `<td><code>${actualStr}</code></td>`;
                    html += `</tr>`;
                });
                
                html += `</tbody></table>`;
            });
            
            // Add week-over-week increment table
            html += `<h2 class="test-category">Week-Over-Week Increments</h2>`;
            html += `<p style="margin-bottom: 10px; color: #666;">Shows the change in 1RM from one week to the next</p>`;
            html += `<table>`;
            html += `<thead><tr><th>Week</th><th>Squat</th><th>Overhead Press</th><th>Pullup</th><th>Deadlift</th><th>Bench</th><th>Row</th></tr></thead>`;
            html += `<tbody>`;
            
            const exercises = ['Squat', 'Overhead Press', 'Pullup', 'Deadlift', 'Bench', 'Row'];
            let prevWeekValues = {};
            
            for (let week = 1; week <= 52; week++) {
                const dayStart = (week - 1) * 7;
                const dayEnd = week * 7 - 1;
                
                html += `<tr>`;
                html += `<td>${week}</td>`;
                
                exercises.forEach(exercise => {
                    const currentValue = compute1RM(exercise, dayEnd);
                    const prevValue = prevWeekValues[exercise];
                    
                    if (prevValue !== undefined) {
                        const increment = currentValue - prevValue;
                        const color = increment < 0 ? '#ff9800' : '#666';
                        html += `<td style="color: ${color};">${increment >= 0 ? '' : ''}${increment.toFixed(2)}</td>`;
                    } else {
                        html += `<td>-</td>`;
                    }
                    
                    prevWeekValues[exercise] = currentValue;
                });
                
                html += `</tr>`;
            }
            
            html += `</tbody></table>`;
            
            // Add weekly weights table
            html += `<h2 style="margin-top: 40px; margin-bottom: 20px;">Weekly 1RM Weights (lb)</h2>`;
            html += `<table style="margin-top: 20px;">`;
            html += `<thead><tr>`;
            html += `<th>Week</th>`;
            html += `<th>Date</th>`;
            exercises.forEach(exercise => {
                html += `<th>${exercise}</th>`;
            });
            html += `</tr></thead>`;
            html += `<tbody>`;
            
            const startDate = new Date('2025-09-15');
            for (let week = 1; week <= 52; week++) {
                const dayEnd = week * 7;
                const weekDate = new Date(startDate);
                weekDate.setDate(weekDate.getDate() + dayEnd);
                const dateStr = `${weekDate.getMonth() + 1}/${weekDate.getDate()}/${weekDate.getFullYear()}`;
                
                html += `<tr>`;
                html += `<td>${week}</td>`;
                html += `<td>${dateStr}</td>`;
                
                exercises.forEach(exercise => {
                    const value = compute1RM(exercise, dayEnd);
                    html += `<td>${value.toFixed(2)}</td>`;
                });
                
                html += `</tr>`;
            }
            
            html += `</tbody></table>`;
            
            // Add weekly working weights table (5 reps)
            html += `<h2 style="margin-top: 40px; margin-bottom: 20px;">Weekly Working Weights @ 5 Reps (lb)</h2>`;
            html += `<p style="margin-bottom: 10px; color: #666;">This shows the actual weight to lift for sets of 5 reps (after Epley formula and rounding). Orange = deload week.</p>`;
            html += `<table style="margin-top: 20px;">`;
            html += `<thead><tr>`;
            html += `<th>Week</th>`;
            html += `<th>Date</th>`;
            exercises.forEach(exercise => {
                html += `<th>${exercise}</th>`;
            });
            html += `</tr></thead>`;
            html += `<tbody>`;
            
            for (let week = 1; week <= 52; week++) {
                const dayEnd = week * 7;
                const weekDate = new Date(startDate);
                weekDate.setDate(weekDate.getDate() + dayEnd);
                const dateStr = `${weekDate.getMonth() + 1}/${weekDate.getDate()}/${weekDate.getFullYear()}`;
                const isDeload = isDeloadWeek(dayEnd);
                
                const rowStyle = isDeload ? 'background: #fff3e0;' : '';
                html += `<tr style="${rowStyle}">`;
                html += `<td>${week}</td>`;
                html += `<td>${dateStr}</td>`;
                
                exercises.forEach(exercise => {
                    const oneRM = compute1RM(exercise, dayEnd);
                    const workingWeight = computeWorkingWeight(oneRM, 5, isDeload, exercise);
                    const roundIncrement = testConfig.round_plates_per_side_to_lb[exercise];
                    
                    let totalWeight;
                    if (testConfig.sets_reps[exercise].type === 'weighted_bodyweight') {
                        // Pullups: round total added weight
                        totalWeight = roundToIncrement(workingWeight, roundIncrement);
                    } else {
                        // Barbell lifts: round per-side then calculate total
                        const weightPerSide = (workingWeight - testConfig.bar_weight_lb) / 2;
                        const roundedPerSide = roundToIncrement(weightPerSide, roundIncrement);
                        totalWeight = testConfig.bar_weight_lb + roundedPerSide * 2;
                    }
                    
                    const color = isDeload ? '#ff6f00' : '#333';
                    html += `<td style="color: ${color};">${totalWeight.toFixed(2)}</td>`;
                });
                
                html += `</tr>`;
            }
            
            html += `</tbody></table>`;
            
            resultsEl.innerHTML = html;
        }

        // Run tests
        renderResults();
    </script>
</body>
</html>

