<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I Just Wanna Lift - Tests</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            color: #1a1a1a;
            background: #fafafa;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .summary {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        .summary.all-pass {
            background: #4caf50;
            color: white;
        }

        .summary.has-fail {
            background: #f44336;
            color: white;
        }

        table {
            width: 100%;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f5f5f5;
            font-weight: 600;
        }

        tr:last-child td {
            border-bottom: none;
        }

        .pass {
            color: #4caf50;
            font-weight: 600;
        }

        .fail {
            color: #f44336;
            font-weight: 600;
        }

        .test-category {
            margin-top: 30px;
            margin-bottom: 10px;
            font-size: 20px;
            font-weight: 600;
        }

        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>I Just Wanna Lift - Unit Tests</h1>
    <div id="summary" class="summary"></div>
    <div id="results"></div>

    <script>
        // Test configuration (matching spec)
        const testConfig = {
            user: {
                name: "Stephen",
                bodyweight_lb: 175,
                start_date: "2025-09-15",
                total_weeks: 52,
                training_days: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"]
            },
            bar_weight_lb: 45,
            rep_scheme: {
                low_reps: 5,
                high_reps: 7
            },
            schedule: {
                pattern: {
                    A: ["Squat", "Overhead Press", "Pullup"],
                    B: ["Deadlift", "Bench", "Row"]
                },
                cycle: ["A", "B", "A'", "B'"]
            },
            sets_reps: {
                "Squat": { sets: 2, alternate_reps: false },
                "Deadlift": { sets: 2, alternate_reps: false },
                "Overhead Press": { sets: 3, alternate_reps: true },
                "Bench": { sets: 3, alternate_reps: true },
                "Row": { sets: 3, alternate_reps: true },
                "Pullup": { sets: 3, alternate_reps: true, type: "weighted_bodyweight" }
            },
            round_plates_per_side_to_lb: {
                "Squat": 1.25,
                "Deadlift": 1.25,
                "Overhead Press": 0.25,
                "Bench": 0.25,
                "Row": 0.25,
                "Pullup": 1.25
            },
            progression: {
                alpha: 0.0105,
                deload_every_weeks: 8,
                deload_factor: 0.82
            },
            targets: {
                goal_bodyweight_multiple: {
                    "Squat": 1.60,
                    "Overhead Press": 0.65,
                    "Pullup": 0.30,
                    "Deadlift": 2.00,
                    "Bench": 1.15,
                    "Row": 0.85
                },
                start_as_percentage_of_goal: {
                    "Squat": 0.50,
                    "Overhead Press": 0.50,
                    "Pullup": 0.00,
                    "Deadlift": 0.50,
                    "Bench": 0.40,
                    "Row": 0.60
                }
            },
            plate_inventory_per_side_lb: [45, 25, 10, 5, 2.5, 1.25, 1, 0.75, 0.5, 0.25]
        };

        // Copy of core functions from index.html
        function parseDate(dateStr) {
            return new Date(dateStr + 'T00:00:00');
        }

        function getDaysElapsed(startDate, currentDate) {
            const start = parseDate(startDate);
            const current = parseDate(currentDate);
            const diffTime = current - start;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        function isTrainingDayISO(iso) {
            const d = parseDate(iso);
            const name = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][d.getDay()];
            return testConfig.user.training_days.includes(name);
        }

        function isRestDayISO(iso) {
            return !isTrainingDayISO(iso);
        }

        function getTrainingDayNumber(startDate, currentDate) {
            const start = parseDate(startDate);
            const current = parseDate(currentDate);
            
            let trainingDays = 0;
            let date = new Date(start);
            
            while (date <= current) {
                const dateISO = formatDateISO(date);
                if (isTrainingDayISO(dateISO)) {
                    trainingDays++;
                }
                date.setDate(date.getDate() + 1);
            }
            
            return trainingDays;
        }

        function formatDateISO(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getCyclePosition(trainingDayNumber) {
            return (trainingDayNumber - 1) % 4;
        }

        function getWeekNumber(daysElapsed) {
            return Math.floor(daysElapsed / 7) + 1;
        }

        function isDeloadWeek(daysElapsed) {
            // Deload every 56 days (8 weeks)
            // Week 9 starts at day 56 (deload week)
            // Check if we've crossed a 56-day boundary this week
            if (daysElapsed < 7) return false; // First week can't be deload
            return Math.floor(daysElapsed / 56) > Math.floor((daysElapsed - 7) / 56);
        }

        function getRepsForExercise(lift, cyclePosition) {
            const exerciseConfig = testConfig.sets_reps[lift];
            if (!exerciseConfig.alternate_reps) {
                return testConfig.rep_scheme.low_reps;
            }
            return (cyclePosition < 2) ? testConfig.rep_scheme.low_reps : testConfig.rep_scheme.high_reps;
        }

        function compute1RM(lift, daysElapsed) {
            const goalWeight = testConfig.targets.goal_bodyweight_multiple[lift] * testConfig.user.bodyweight_lb;
            const startWeight = testConfig.targets.start_as_percentage_of_goal[lift] * goalWeight;
            
            const t = Math.max(0, Math.min(daysElapsed, 364));
            const T = 364;
            const alpha = testConfig.progression.alpha;
            
            if (T === 0) return goalWeight;
            
            const progressionFactor = Math.log(1 + alpha * t) / Math.log(1 + alpha * T);
            const oneRM = startWeight + (goalWeight - startWeight) * progressionFactor;
            
            return oneRM;
        }

        function computeWorkingWeight(oneRM, reps, isDeload) {
            let workingWeight = oneRM / (1 + reps / 30);
            
            if (isDeload) {
                workingWeight *= testConfig.progression.deload_factor;
            }
            
            return workingWeight;
        }

        function roundToIncrement(value, increment) {
            return Math.round(value / increment) * increment;
        }

        function plateMath(weightPerSide, plateInventory) {
            const plates = [];
            let remaining = weightPerSide;
            
            for (const plate of plateInventory) {
                while (remaining >= plate - 0.001) {
                    plates.push(plate);
                    remaining -= plate;
                }
            }
            
            return plates;
        }

        // Test framework
        function assert(description, expected, actual, tolerance = 0.01) {
            let pass;
            if (typeof expected === 'number' && typeof actual === 'number') {
                pass = Math.abs(expected - actual) < tolerance;
            } else if (Array.isArray(expected) && Array.isArray(actual)) {
                pass = JSON.stringify(expected) === JSON.stringify(actual);
            } else {
                pass = expected === actual;
            }
            
            return { pass, description, expected, actual };
        }

        // Test suites
        const tests = [];

        function addTest(category, description, expected, actual, tolerance) {
            tests.push({
                category,
                ...assert(description, expected, actual, tolerance)
            });
        }

        // 1. Date & Day Calculations
        addTest('Date/Day', 'getDaysElapsed: same day', 0, getDaysElapsed('2025-09-15', '2025-09-15'));
        addTest('Date/Day', 'getDaysElapsed: next day', 1, getDaysElapsed('2025-09-15', '2025-09-16'));
        addTest('Date/Day', 'getDaysElapsed: one week', 7, getDaysElapsed('2025-09-15', '2025-09-22'));
        
        addTest('Date/Day', 'getTrainingDayNumber: Day 1 (Mon)', 1, getTrainingDayNumber('2025-09-15', '2025-09-15'));
        addTest('Date/Day', 'getTrainingDayNumber: Day 5 (Fri)', 5, getTrainingDayNumber('2025-09-15', '2025-09-19'));
        addTest('Date/Day', 'getTrainingDayNumber: Skip weekend to Day 6 (Mon)', 6, getTrainingDayNumber('2025-09-15', '2025-09-22'));
        addTest('Date/Day', 'getTrainingDayNumber: Day 10', 10, getTrainingDayNumber('2025-09-15', '2025-09-26'));
        
        addTest('Date/Day', 'getCyclePosition: Day 1 = 0 (A)', 0, getCyclePosition(1));
        addTest('Date/Day', 'getCyclePosition: Day 2 = 1 (B)', 1, getCyclePosition(2));
        addTest('Date/Day', 'getCyclePosition: Day 3 = 2 (A\')', 2, getCyclePosition(3));
        addTest('Date/Day', 'getCyclePosition: Day 4 = 3 (B\')', 3, getCyclePosition(4));
        addTest('Date/Day', 'getCyclePosition: Day 5 = 0 (A)', 0, getCyclePosition(5));
        
        addTest('Date/Day', 'getWeekNumber: Day 0 = Week 1', 1, getWeekNumber(0));
        addTest('Date/Day', 'getWeekNumber: Day 6 = Week 1', 1, getWeekNumber(6));
        addTest('Date/Day', 'getWeekNumber: Day 7 = Week 2', 2, getWeekNumber(7));
        addTest('Date/Day', 'getWeekNumber: Day 13 = Week 2', 2, getWeekNumber(13));
        addTest('Date/Day', 'getWeekNumber: Day 14 = Week 3', 3, getWeekNumber(14));

        // 2. Deload Weeks (OLD - these tests are wrong, see "Deload Days" section below)
        addTest('Deload (OLD)', 'isDeloadWeek: Days 49-55 (Week 8)', false, isDeloadWeek(49));
        addTest('Deload (OLD)', 'isDeloadWeek: Days 49-55 (Week 8)', false, isDeloadWeek(55));
        addTest('Deload (OLD)', 'isDeloadWeek: Day 0-6 (Week 1)', false, isDeloadWeek(0));
        addTest('Deload (OLD)', 'isDeloadWeek: Day 0-6 (Week 1)', false, isDeloadWeek(6));

        // 3. Rep Selection
        addTest('Reps', 'Squat at position 0: 5 reps', 5, getRepsForExercise('Squat', 0));
        addTest('Reps', 'Squat at position 2: 5 reps (no alt)', 5, getRepsForExercise('Squat', 2));
        addTest('Reps', 'Overhead Press at position 0: 5 reps', 5, getRepsForExercise('Overhead Press', 0));
        addTest('Reps', 'Overhead Press at position 1: 5 reps', 5, getRepsForExercise('Overhead Press', 1));
        addTest('Reps', 'Overhead Press at position 2: 7 reps', 7, getRepsForExercise('Overhead Press', 2));
        addTest('Reps', 'Overhead Press at position 3: 7 reps', 7, getRepsForExercise('Overhead Press', 3));
        addTest('Reps', 'Deadlift at position 3: 5 reps (no alt)', 5, getRepsForExercise('Deadlift', 3));

        // 4. Weight Progression (using calendar days: Day 0 = start, Day 364 = end of year)
        // Calculate expected values from config
        const squatGoal = testConfig.targets.goal_bodyweight_multiple['Squat'] * testConfig.user.bodyweight_lb;
        const squatStart = testConfig.targets.start_as_percentage_of_goal['Squat'] * squatGoal;
        addTest('1RM', 'Squat Day 0: start weight', squatStart, compute1RM('Squat', 0), 0.1);
        addTest('1RM', 'Squat Day 182: 2/3 to goal', squatStart + (squatGoal - squatStart) * 2/3, compute1RM('Squat', 182), 2.5);
        addTest('1RM', 'Squat Day 364: goal weight', squatGoal, compute1RM('Squat', 364), 0.1);
        
        const pullupGoal = testConfig.targets.goal_bodyweight_multiple['Pullup'] * testConfig.user.bodyweight_lb;
        const pullupStart = testConfig.targets.start_as_percentage_of_goal['Pullup'] * pullupGoal;
        addTest('1RM', 'Pullup Day 0: 0 lb', pullupStart, compute1RM('Pullup', 0), 0.1);
        addTest('1RM', 'Pullup Day 182: 2/3 to goal', pullupStart + (pullupGoal - pullupStart) * 2/3, compute1RM('Pullup', 182), 1.0);
        addTest('1RM', 'Pullup Day 364: goal weight', pullupGoal, compute1RM('Pullup', 364), 0.1);
        
        const deadliftGoal = testConfig.targets.goal_bodyweight_multiple['Deadlift'] * testConfig.user.bodyweight_lb;
        const deadliftStart = testConfig.targets.start_as_percentage_of_goal['Deadlift'] * deadliftGoal;
        addTest('1RM', 'Deadlift Day 0: start weight', deadliftStart, compute1RM('Deadlift', 0), 0.1);
        addTest('1RM', 'Deadlift Day 182: 2/3 to goal', deadliftStart + (deadliftGoal - deadliftStart) * 2/3, compute1RM('Deadlift', 182), 3.0);
        addTest('1RM', 'Deadlift Day 364: goal weight', deadliftGoal, compute1RM('Deadlift', 364), 0.1);
        
        const benchGoal = testConfig.targets.goal_bodyweight_multiple['Bench'] * testConfig.user.bodyweight_lb;
        const benchStart = testConfig.targets.start_as_percentage_of_goal['Bench'] * benchGoal;
        addTest('1RM', 'Bench Day 0: start weight', benchStart, compute1RM('Bench', 0), 0.1);
        addTest('1RM', 'Bench Day 182: 2/3 to goal', benchStart + (benchGoal - benchStart) * 2/3, compute1RM('Bench', 182), 2.0);
        addTest('1RM', 'Bench Day 364: goal weight', benchGoal, compute1RM('Bench', 364), 0.1);
        
        const ohpGoal = testConfig.targets.goal_bodyweight_multiple['Overhead Press'] * testConfig.user.bodyweight_lb;
        const ohpStart = testConfig.targets.start_as_percentage_of_goal['Overhead Press'] * ohpGoal;
        addTest('1RM', 'OHP Day 0: start weight', ohpStart, compute1RM('Overhead Press', 0), 0.1);
        addTest('1RM', 'OHP Day 182: 2/3 to goal', ohpStart + (ohpGoal - ohpStart) * 2/3, compute1RM('Overhead Press', 182), 1.0);
        addTest('1RM', 'OHP Day 364: goal weight', ohpGoal, compute1RM('Overhead Press', 364), 0.1);
        
        const rowGoal = testConfig.targets.goal_bodyweight_multiple['Row'] * testConfig.user.bodyweight_lb;
        const rowStart = testConfig.targets.start_as_percentage_of_goal['Row'] * rowGoal;
        addTest('1RM', 'Row Day 0: start weight', rowStart, compute1RM('Row', 0), 0.1);
        addTest('1RM', 'Row Day 182: 2/3 to goal', rowStart + (rowGoal - rowStart) * 2/3, compute1RM('Row', 182), 1.5);
        addTest('1RM', 'Row Day 364: goal weight', rowGoal, compute1RM('Row', 364), 0.1);

        // 5. Working Weight (Epley)
        addTest('Epley', '200 lb 1RM at 5 reps', 171.43, computeWorkingWeight(200, 5, false), 0.1);
        addTest('Epley', '200 lb 1RM at 7 reps', 162.16, computeWorkingWeight(200, 7, false), 0.1);
        addTest('Epley', '200 lb 1RM at 5 reps with deload', 140.57, computeWorkingWeight(200, 5, true), 0.1);
        addTest('Epley', '100 lb 1RM at 5 reps', 85.71, computeWorkingWeight(100, 5, false), 0.1);

        // 6. Rounding
        addTest('Rounding', '100.1 to 0.25 lb', 100, roundToIncrement(100.1, 0.25));
        addTest('Rounding', '100.13 to 0.25 lb', 100.25, roundToIncrement(100.13, 0.25));
        addTest('Rounding', '100.24 to 0.25 lb', 100.25, roundToIncrement(100.24, 0.25));
        addTest('Rounding', '57.4 to 1.25 lb', 57.5, roundToIncrement(57.4, 1.25));
        addTest('Rounding', '57.6 to 1.25 lb', 57.5, roundToIncrement(57.6, 1.25));
        addTest('Rounding', '58.7 to 1.25 lb', 58.75, roundToIncrement(58.7, 1.25));

        // 7. Plate Math
        addTest('Plates', '100 lb/side', [45, 45, 10], plateMath(100, testConfig.plate_inventory_per_side_lb));
        addTest('Plates', '57.5 lb/side', [45, 10, 2.5], plateMath(57.5, testConfig.plate_inventory_per_side_lb));
        addTest('Plates', '2.75 lb/side', [2.5, 0.25], plateMath(2.75, testConfig.plate_inventory_per_side_lb));
        addTest('Plates', '0 lb/side', [], plateMath(0, testConfig.plate_inventory_per_side_lb));
        addTest('Plates', '45 lb/side', [45], plateMath(45, testConfig.plate_inventory_per_side_lb));

        // 8. Deload Application (calendar days not week numbers!)
        addTest('Deload Days', 'isDeloadWeek: Day 56 (end of week 8)', true, isDeloadWeek(56));
        addTest('Deload Days', 'isDeloadWeek: Day 55 (last day of week 8)', false, isDeloadWeek(55));
        addTest('Deload Days', 'isDeloadWeek: Day 112 (end of week 16)', true, isDeloadWeek(112));
        addTest('Deload Days', 'isDeloadWeek: Day 168 (end of week 24)', true, isDeloadWeek(168));
        addTest('Deload Days', 'isDeloadWeek: Day 49 (week 7)', false, isDeloadWeek(49));
        addTest('Deload Days', 'isDeloadWeek: Day 63 (week 9)', false, isDeloadWeek(63));

        // 9. Rest/Training Day Functions (updated for config-driven)
        addTest('Rest/Training', 'isTrainingDayISO: Monday', true, isTrainingDayISO('2025-09-15'));
        addTest('Rest/Training', 'isTrainingDayISO: Friday', true, isTrainingDayISO('2025-09-19'));
        addTest('Rest/Training', 'isTrainingDayISO: Saturday', false, isTrainingDayISO('2025-09-20'));
        addTest('Rest/Training', 'isTrainingDayISO: Sunday', false, isTrainingDayISO('2025-09-21'));
        addTest('Rest/Training', 'isRestDayISO: Saturday', true, isRestDayISO('2025-09-20'));
        addTest('Rest/Training', 'isRestDayISO: Monday', false, isRestDayISO('2025-09-15'));

        // 10. End-to-End Working Weight (1RM → Epley → Round → Plates)
        // Squat on Day 28 (Mon Oct 13)
        const day28Squat1RM = compute1RM('Squat', 28);
        const day28SquatWorking = computeWorkingWeight(day28Squat1RM, 5, false);
        const day28SquatPerSide = (day28SquatWorking - testConfig.bar_weight_lb) / 2;
        const day28SquatRounded = roundToIncrement(day28SquatPerSide, 1.25);
        const day28SquatTotal = testConfig.bar_weight_lb + day28SquatRounded * 2;
        addTest('End-to-End', 'Squat Day 28: 1RM', 168.03, day28Squat1RM, 0.5);
        addTest('End-to-End', 'Squat Day 28: Working weight (5 reps)', 144.02, day28SquatWorking, 0.5);
        addTest('End-to-End', 'Squat Day 28: Total rounded weight', 145.0, day28SquatTotal, 0.5);
        
        // 11. Spreadsheet Validation (compare against known good values from your spreadsheet)
        // Week 5 = Day 35 (end of week 5)
        // NOTE: These are snapshot tests - update them when you regenerate your spreadsheet with new goals
        addTest('Spreadsheet', 'Squat Week 5 (Day 35)', 167.85, compute1RM('Squat', 35), 0.5);
        addTest('Spreadsheet', 'OHP Week 5 (Day 35)', 68.19, compute1RM('Overhead Press', 35), 0.5);
        addTest('Spreadsheet', 'Pullup Week 5 (Day 35)', 10.44, compute1RM('Pullup', 35), 0.5);
        addTest('Spreadsheet', 'Deadlift Week 5 (Day 35)', 209.82, compute1RM('Deadlift', 35), 0.5);
        addTest('Spreadsheet', 'Bench Week 5 (Day 35)', 104.52, compute1RM('Bench', 35), 0.5);
        addTest('Spreadsheet', 'Row Week 5 (Day 35)', 101.09, compute1RM('Row', 35), 0.5);
        
        // Week 1 = Day 7
        addTest('Spreadsheet', 'Squat Week 1 (Day 7)', 150.88, compute1RM('Squat', 7), 0.5);
        addTest('Spreadsheet', 'Bench Week 1 (Day 7)', 89.68, compute1RM('Bench', 7), 0.5);
        
        // Week 52 = Day 364 (should hit goals from config)
        addTest('Spreadsheet', 'Squat Week 52 (Day 364)', squatGoal, compute1RM('Squat', 364), 0.5);
        addTest('Spreadsheet', 'Bench Week 52 (Day 364)', benchGoal, compute1RM('Bench', 364), 0.5);
        addTest('Spreadsheet', 'OHP Week 52 (Day 364)', ohpGoal, compute1RM('Overhead Press', 364), 0.5);

        // 12. Edge Cases
        addTest('Edge Cases', '1RM at Day -1 (before start)', squatStart, compute1RM('Squat', -1), 0.1);
        addTest('Edge Cases', '1RM at Day 400 (past end)', squatGoal, compute1RM('Squat', 400), 0.1);
        addTest('Edge Cases', 'getWeekNumber: Day 0', 1, getWeekNumber(0));
        addTest('Edge Cases', 'getWeekNumber: Day 364', 53, getWeekNumber(364));

        // 13. Deload Factor Application
        const deloadOneRM = 200;
        const normalWorking = computeWorkingWeight(deloadOneRM, 5, false);
        const deloadWorking = computeWorkingWeight(deloadOneRM, 5, true);
        addTest('Deload Factor', 'Normal working weight (200 @ 5 reps)', 171.43, normalWorking, 0.1);
        addTest('Deload Factor', 'Deload working weight (200 @ 5 reps)', 140.57, deloadWorking, 0.1);
        addTest('Deload Factor', 'Deload is 82% of normal', normalWorking * 0.82, deloadWorking, 0.1);

        // 14. Weighted Bodyweight Exercise (Pullups)
        const pullup1RM_day35 = compute1RM('Pullup', 35);
        const pullupWorking_5reps = computeWorkingWeight(pullup1RM_day35, 5, false);
        const pullupRounded = roundToIncrement(pullupWorking_5reps, testConfig.round_plates_per_side_to_lb['Pullup']);
        addTest('Pullup', 'Pullup 1RM Day 35', 11.49, pullup1RM_day35, 0.5);
        addTest('Pullup', 'Pullup working weight (5 reps)', 9.85, pullupWorking_5reps, 0.5);
        addTest('Pullup', 'Pullup rounded to 1.25 lb', 10.0, pullupRounded, 0.5);
        // Pullup should NOT divide by 2 or subtract bar weight (it's total added weight)

        // 15. Alternating Reps Through Full Cycle
        // OHP alternates: A/B = 5 reps, A'/B' = 7 reps
        addTest('Rep Cycle', 'OHP Cycle Position 0 (A): 5 reps', 5, getRepsForExercise('Overhead Press', 0));
        addTest('Rep Cycle', 'OHP Cycle Position 1 (B): 5 reps', 5, getRepsForExercise('Overhead Press', 1));
        addTest('Rep Cycle', 'OHP Cycle Position 2 (A\'): 7 reps', 7, getRepsForExercise('Overhead Press', 2));
        addTest('Rep Cycle', 'OHP Cycle Position 3 (B\'): 7 reps', 7, getRepsForExercise('Overhead Press', 3));
        
        // Verify working weight changes with reps
        const ohp1RM = 100;
        const ohpWork5 = computeWorkingWeight(ohp1RM, 5, false);
        const ohpWork7 = computeWorkingWeight(ohp1RM, 7, false);
        addTest('Rep Cycle', 'OHP 100lb 1RM @ 5 reps', 85.71, ohpWork5, 0.1);
        addTest('Rep Cycle', 'OHP 100lb 1RM @ 7 reps', 81.08, ohpWork7, 0.1);
        addTest('Rep Cycle', '7 reps < 5 reps (lighter)', true, ohpWork7 < ohpWork5);

        // 16. End-to-End Deload Week
        // Day 56 = first deload day
        const squat1RM_day56 = compute1RM('Squat', 56);
        const squatWorkingNormal_day56 = computeWorkingWeight(squat1RM_day56, 5, false);
        const squatWorkingDeload_day56 = computeWorkingWeight(squat1RM_day56, 5, true);
        const squatDeloadPerSide = (squatWorkingDeload_day56 - testConfig.bar_weight_lb) / 2;
        const squatDeloadRounded = roundToIncrement(squatDeloadPerSide, 1.25);
        const squatDeloadTotal = testConfig.bar_weight_lb + squatDeloadRounded * 2;
        addTest('Deload E2E', 'Squat Day 56: is deload week', true, isDeloadWeek(56));
        addTest('Deload E2E', 'Squat Day 56: 1RM', 186.82, squat1RM_day56, 0.5);
        addTest('Deload E2E', 'Squat Day 56: normal working', 160.13, squatWorkingNormal_day56, 0.5);
        addTest('Deload E2E', 'Squat Day 56: deload working', 131.31, squatWorkingDeload_day56, 0.5);
        addTest('Deload E2E', 'Squat Day 56: deload total', 132.50, squatDeloadTotal, 0.5);

        // 17. Date Navigation
        addTest('Date Nav', 'Next training after Mon', '2025-09-16', getNextTrainingDate('2025-09-15'));
        addTest('Date Nav', 'Next training after Fri', '2025-09-22', getNextTrainingDate('2025-09-19'));
        addTest('Date Nav', 'Next training after Sat (skip Sun)', '2025-09-22', getNextTrainingDate('2025-09-20'));
        addTest('Date Nav', 'Next training after Sun', '2025-09-22', getNextTrainingDate('2025-09-21'));
        
        function getNextTrainingDate(fromDate) {
            const date = parseDate(fromDate);
            date.setDate(date.getDate() + 1);
            while (isRestDayISO(formatDateISO(date))) {
                date.setDate(date.getDate() + 1);
            }
            return formatDateISO(date);
        }

        // 18. Multiple Exercises Same Day (Independence)
        // Day 28: Squat, OHP, Pullup (A workout)
        const day28_squat = compute1RM('Squat', 28);
        const day28_ohp = compute1RM('Overhead Press', 28);
        const day28_pullup = compute1RM('Pullup', 28);
        addTest('Multi-Exercise', 'Day 28 Squat 1RM', 168.03, day28_squat, 0.5);
        addTest('Multi-Exercise', 'Day 28 OHP 1RM', 76.38, day28_ohp, 0.5);
        addTest('Multi-Exercise', 'Day 28 Pullup 1RM', 9.46, day28_pullup, 0.5);
        // All different exercises should have independent progressions
        addTest('Multi-Exercise', 'Exercises are independent', true, day28_squat !== day28_ohp && day28_ohp !== day28_pullup);

        // 19. Long-term Stability
        // Test that progression is smooth over long periods
        const day100 = compute1RM('Squat', 100);
        const day200 = compute1RM('Squat', 200);
        const day300 = compute1RM('Squat', 300);
        addTest('Long-term', 'Day 100 < Day 200', true, day100 < day200);
        addTest('Long-term', 'Day 200 < Day 300', true, day200 < day300);
        addTest('Long-term', 'Day 300 < Goal', true, day300 < squatGoal);
        addTest('Long-term', 'Progression is monotonic', true, day100 < day200 && day200 < day300);

        // 20. Rounding Edge Cases
        addTest('Rounding Edge', '42.50 to 1.25 rounds correctly', 42.5, roundToIncrement(42.5, 1.25));
        addTest('Rounding Edge', '42.6249 rounds to 42.5', 42.5, roundToIncrement(42.6249, 1.25));
        addTest('Rounding Edge', '42.625 rounds to 42.5', 42.5, roundToIncrement(42.625, 1.25));
        addTest('Rounding Edge', '43.5 rounds to 43.75', 43.75, roundToIncrement(43.5, 1.25));
        addTest('Rounding Edge', '0.125 to 0.25 rounds to 0.25', 0.25, roundToIncrement(0.125, 0.25));
        addTest('Rounding Edge', '0.124 to 0.25 rounds to 0', 0, roundToIncrement(0.124, 0.25));

        // 21. Zero/Empty Plate Cases
        addTest('Zero Plates', 'Empty bar (0 per side)', [], plateMath(0, testConfig.plate_inventory_per_side_lb));
        addTest('Zero Plates', 'Very small weight (0.1 per side)', [], plateMath(0.1, testConfig.plate_inventory_per_side_lb));
        addTest('Zero Plates', 'Exactly 0.25 plate', [0.25], plateMath(0.25, testConfig.plate_inventory_per_side_lb));

        // 22. Cycle Position Wraparound
        // Cycle is 4 positions: (trainingDay - 1) % 4
        addTest('Cycle Wrap', 'Training Day 5 wraps to position 0', 0, getCyclePosition(5));
        addTest('Cycle Wrap', 'Training Day 8 wraps to position 3', 3, getCyclePosition(8));
        addTest('Cycle Wrap', 'Training Day 9 wraps to position 0', 0, getCyclePosition(9));
        addTest('Cycle Wrap', 'Training Day 100 position', 3, getCyclePosition(100));
        addTest('Cycle Wrap', 'Training Day 101 position', 0, getCyclePosition(101));

        // Render results
        function renderResults() {
            const passed = tests.filter(t => t.pass).length;
            const failed = tests.filter(t => !t.pass).length;
            const total = tests.length;
            
            const summaryEl = document.getElementById('summary');
            summaryEl.className = `summary ${failed === 0 ? 'all-pass' : 'has-fail'}`;
            summaryEl.textContent = `Tests: ${passed} passed, ${failed} failed (${total} total)`;
            
            const categories = [...new Set(tests.map(t => t.category))];
            const resultsEl = document.getElementById('results');
            
            let html = '';
            categories.forEach(category => {
                const categoryTests = tests.filter(t => t.category === category);
                html += `<h2 class="test-category">${category}</h2>`;
                html += `<table>`;
                html += `<thead><tr><th>Status</th><th>Description</th><th>Expected</th><th>Actual</th></tr></thead>`;
                html += `<tbody>`;
                
                categoryTests.forEach(test => {
                    const statusClass = test.pass ? 'pass' : 'fail';
                    const statusText = test.pass ? '✓ PASS' : '✗ FAIL';
                    const expectedStr = Array.isArray(test.expected) 
                        ? `[${test.expected.join(', ')}]` 
                        : test.expected;
                    const actualStr = Array.isArray(test.actual) 
                        ? `[${test.actual.join(', ')}]` 
                        : test.actual;
                    
                    html += `<tr>`;
                    html += `<td class="${statusClass}">${statusText}</td>`;
                    html += `<td>${test.description}</td>`;
                    html += `<td><code>${expectedStr}</code></td>`;
                    html += `<td><code>${actualStr}</code></td>`;
                    html += `</tr>`;
                });
                
                html += `</tbody></table>`;
            });
            
            // Add week-over-week increment table
            html += `<h2 class="test-category">Week-Over-Week Increments</h2>`;
            html += `<p style="margin-bottom: 10px; color: #666;">Shows the change in 1RM from one week to the next</p>`;
            html += `<table>`;
            html += `<thead><tr><th>Week</th><th>Squat</th><th>Overhead Press</th><th>Pullup</th><th>Deadlift</th><th>Bench</th><th>Row</th></tr></thead>`;
            html += `<tbody>`;
            
            const exercises = ['Squat', 'Overhead Press', 'Pullup', 'Deadlift', 'Bench', 'Row'];
            let prevWeekValues = {};
            
            for (let week = 1; week <= 52; week++) {
                const dayStart = (week - 1) * 7;
                const dayEnd = week * 7 - 1;
                
                html += `<tr>`;
                html += `<td>${week}</td>`;
                
                exercises.forEach(exercise => {
                    const currentValue = compute1RM(exercise, dayEnd);
                    const prevValue = prevWeekValues[exercise];
                    
                    if (prevValue !== undefined) {
                        const increment = currentValue - prevValue;
                        const color = increment < 0 ? '#ff9800' : '#666';
                        html += `<td style="color: ${color};">${increment >= 0 ? '' : ''}${increment.toFixed(2)}</td>`;
                    } else {
                        html += `<td>-</td>`;
                    }
                    
                    prevWeekValues[exercise] = currentValue;
                });
                
                html += `</tr>`;
            }
            
            html += `</tbody></table>`;
            
            // Add weekly weights table
            html += `<h2 style="margin-top: 40px; margin-bottom: 20px;">Weekly 1RM Weights (lb)</h2>`;
            html += `<table style="margin-top: 20px;">`;
            html += `<thead><tr>`;
            html += `<th>Week</th>`;
            html += `<th>Date</th>`;
            exercises.forEach(exercise => {
                html += `<th>${exercise}</th>`;
            });
            html += `</tr></thead>`;
            html += `<tbody>`;
            
            const startDate = new Date('2025-09-15');
            for (let week = 1; week <= 52; week++) {
                const dayEnd = week * 7;
                const weekDate = new Date(startDate);
                weekDate.setDate(weekDate.getDate() + dayEnd);
                const dateStr = `${weekDate.getMonth() + 1}/${weekDate.getDate()}/${weekDate.getFullYear()}`;
                
                html += `<tr>`;
                html += `<td>${week}</td>`;
                html += `<td>${dateStr}</td>`;
                
                exercises.forEach(exercise => {
                    const value = compute1RM(exercise, dayEnd);
                    html += `<td>${value.toFixed(2)}</td>`;
                });
                
                html += `</tr>`;
            }
            
            html += `</tbody></table>`;
            
            // Add weekly working weights table (5 reps)
            html += `<h2 style="margin-top: 40px; margin-bottom: 20px;">Weekly Working Weights @ 5 Reps (lb)</h2>`;
            html += `<p style="margin-bottom: 10px; color: #666;">This shows the actual weight to lift for sets of 5 reps (after Epley formula and rounding). Orange = deload week.</p>`;
            html += `<table style="margin-top: 20px;">`;
            html += `<thead><tr>`;
            html += `<th>Week</th>`;
            html += `<th>Date</th>`;
            exercises.forEach(exercise => {
                html += `<th>${exercise}</th>`;
            });
            html += `</tr></thead>`;
            html += `<tbody>`;
            
            for (let week = 1; week <= 52; week++) {
                const dayEnd = week * 7;
                const weekDate = new Date(startDate);
                weekDate.setDate(weekDate.getDate() + dayEnd);
                const dateStr = `${weekDate.getMonth() + 1}/${weekDate.getDate()}/${weekDate.getFullYear()}`;
                const isDeload = isDeloadWeek(dayEnd);
                
                const rowStyle = isDeload ? 'background: #fff3e0;' : '';
                html += `<tr style="${rowStyle}">`;
                html += `<td>${week}</td>`;
                html += `<td>${dateStr}</td>`;
                
                exercises.forEach(exercise => {
                    const oneRM = compute1RM(exercise, dayEnd);
                    const workingWeight = computeWorkingWeight(oneRM, 5, isDeload);
                    const roundIncrement = testConfig.round_plates_per_side_to_lb[exercise];
                    
                    let totalWeight;
                    if (testConfig.sets_reps[exercise].type === 'weighted_bodyweight') {
                        // Pullups: round total added weight
                        totalWeight = roundToIncrement(workingWeight, roundIncrement);
                    } else {
                        // Barbell lifts: round per-side then calculate total
                        const weightPerSide = (workingWeight - testConfig.bar_weight_lb) / 2;
                        const roundedPerSide = roundToIncrement(weightPerSide, roundIncrement);
                        totalWeight = testConfig.bar_weight_lb + roundedPerSide * 2;
                    }
                    
                    const color = isDeload ? '#ff6f00' : '#333';
                    html += `<td style="color: ${color};">${totalWeight.toFixed(2)}</td>`;
                });
                
                html += `</tr>`;
            }
            
            html += `</tbody></table>`;
            
            resultsEl.innerHTML = html;
        }

        // Run tests
        renderResults();
    </script>
</body>
</html>

